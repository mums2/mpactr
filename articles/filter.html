<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Filter • mpactr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Filter">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mpactr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/reference_semantics.html">Reference Semantics</a></li>
    <li><a class="dropdown-item" href="../articles/filter2.html">Filter</a></li>
    <li><a class="dropdown-item" href="../articles/downstream_analyses.html">Additional Analyses</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mums2/mpactr"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Filter</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mums2/mpactr/blob/v0.1.0/vignettes/articles/filter.Rmd" class="external-link"><code>vignettes/articles/filter.Rmd</code></a></small>
      <div class="d-none name"><code>filter.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># library(mpactr)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mums2.github.io/mpactr/">mpactr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="load-data-into-r">Load data into R<a class="anchor" aria-label="anchor" href="#load-data-into-r"></a>
</h2>
<p>mpactr requires 2 files as input: a feature table and metadata file.
Both are expected to be comma separated files (<em>.csv</em>).</p>
<ol style="list-style-type: decimal">
<li>peak_table: a peak table in Progenesis format is expected. To export
a compatable peak table in Progenesis, navigate to the <em>Review
Compounds</em> tab then File -&gt; Export Compound Measurements. Select
the following properties: Compound, m/z, Retention time (min), and Raw
abundance and click ok.</li>
<li>metadata: a table with sample information. At minimum the following
columns are expected: Injection, Sample_Code, and Biological_Group.
Injection is the sample name and is expected to match sample column
names in the peak_table. Sample_Code is the id for technical replicate
groups. Biological_Group is the id for biological replicate groups.
Other sample metadata can be added, and is encouraged for downstream
analysis following filtering with mpactr.</li>
</ol>
<p>To import your data into R, use the mpactr function
<code><a href="../reference/import_data.html">import_data()</a></code>, which has the arguments:
<code>peak_table_file_path</code> and <code>meta_data_file_path</code>.
Note - you do not need to use <code><a href="../reference/example.html">example()</a></code> if you are using
your own files. This is a package function that allows access to
internal package data. If you simply want to play around with the packge
using example data, you can run the <code>import_data</code> function as
shown above, otherwise, provide file paths for your own files. The
function is expecting files the the extension <code>.csv</code>. The
<code>meta_data</code> argument will also accept an R
<code>data.frame</code> or <code>data.table</code> object, assuming it
is in the correct format. This can be useful of you need to manually
format an existing metadata file, or want to extract metadata
information from your peak table column names.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_data.html">import_data</a></span><span class="op">(</span><span class="fu"><a href="../reference/example.html">example</a></span><span class="op">(</span><span class="st">"cultures_peak_table.csv"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/example.html">example</a></span><span class="op">(</span><span class="st">"cultures_metadata.csv"</span><span class="op">)</span>,</span>
<span>  format <span class="op">=</span> <span class="st">"Progenesis"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This will create an R6 class object, which will store both the peak
table and metadata.</p>
<p>Calling the new mpactr object will print the current peak table in
the terminal:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span></span>
<span><span class="co">#&gt;       Compound       mz         rt 102623_UM1848B_JC1_69_1_5004</span></span>
<span><span class="co">#&gt;         &lt;char&gt;    &lt;num&gt;      &lt;num&gt;                        &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:        1 256.0883  0.7748333                         0.00</span></span>
<span><span class="co">#&gt;    2:        2 484.2921  0.7756667                       546.56</span></span>
<span><span class="co">#&gt;    3:        3 445.2276  0.7786667                         0.00</span></span>
<span><span class="co">#&gt;    4:        4 354.1842  0.7786667                         0.00</span></span>
<span><span class="co">#&gt;    5:        5 353.1995  0.7816667                         0.00</span></span>
<span><span class="co">#&gt;   ---                                                          </span></span>
<span><span class="co">#&gt; 1330:     1330 538.3182 11.4396667                         0.00</span></span>
<span><span class="co">#&gt; 1331:     1331 424.2710 11.4315000                         0.00</span></span>
<span><span class="co">#&gt; 1332:     1332 422.1770 11.4568333                     10655.27</span></span>
<span><span class="co">#&gt; 1333:     1333 422.1776 11.4528333                       923.77</span></span>
<span><span class="co">#&gt; 1334:     1334 538.3981 11.4811667                      1176.19</span></span>
<span><span class="co">#&gt;       102623_UM1846B_Media_67_1_5005 102623_UM1847B_JC28_68_1_5006</span></span>
<span><span class="co">#&gt;                                &lt;num&gt;                         &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:                           0.00                       5358.26</span></span>
<span><span class="co">#&gt;    2:                       16389.28                          0.00</span></span>
<span><span class="co">#&gt;    3:                       22515.28                          0.00</span></span>
<span><span class="co">#&gt;    4:                        6086.35                          0.00</span></span>
<span><span class="co">#&gt;    5:                        5923.96                          0.00</span></span>
<span><span class="co">#&gt;   ---                                                             </span></span>
<span><span class="co">#&gt; 1330:                           0.00                      21222.45</span></span>
<span><span class="co">#&gt; 1331:                           0.00                      39842.07</span></span>
<span><span class="co">#&gt; 1332:                        5737.01                      33477.91</span></span>
<span><span class="co">#&gt; 1333:                           0.00                       6012.07</span></span>
<span><span class="co">#&gt; 1334:                        1353.96                      14792.94</span></span>
<span><span class="co">#&gt;       102623_UM1850B_ANGDT_71_1_5007 102623_UM1849B_ANG18_70_1_5008</span></span>
<span><span class="co">#&gt;                                &lt;num&gt;                          &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:                        4131.40                        3398.08</span></span>
<span><span class="co">#&gt;    2:                           0.00                           0.00</span></span>
<span><span class="co">#&gt;    3:                           0.00                        1641.70</span></span>
<span><span class="co">#&gt;    4:                           0.00                           0.00</span></span>
<span><span class="co">#&gt;    5:                           0.00                           0.00</span></span>
<span><span class="co">#&gt;   ---                                                              </span></span>
<span><span class="co">#&gt; 1330:                        5798.99                           0.00</span></span>
<span><span class="co">#&gt; 1331:                           0.00                       40318.68</span></span>
<span><span class="co">#&gt; 1332:                       28487.39                       11222.92</span></span>
<span><span class="co">#&gt; 1333:                        4634.47                        1250.37</span></span>
<span><span class="co">#&gt; 1334:                        3151.34                        1590.32</span></span>
<span><span class="co">#&gt;       102623_UM1852B_Coculture_72_1_5009 102623_MixedMonoculture_84_1_5015</span></span>
<span><span class="co">#&gt;                                    &lt;num&gt;                             &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:                            5464.43                           3299.94</span></span>
<span><span class="co">#&gt;    2:                               0.00                              0.00</span></span>
<span><span class="co">#&gt;    3:                               0.00                              0.00</span></span>
<span><span class="co">#&gt;    4:                               0.00                              0.00</span></span>
<span><span class="co">#&gt;    5:                               0.00                              0.00</span></span>
<span><span class="co">#&gt;   ---                                                                     </span></span>
<span><span class="co">#&gt; 1330:                           30536.02                           7732.14</span></span>
<span><span class="co">#&gt; 1331:                           26284.99                              0.00</span></span>
<span><span class="co">#&gt; 1332:                           20043.54                          20653.87</span></span>
<span><span class="co">#&gt; 1333:                            1112.28                           2910.70</span></span>
<span><span class="co">#&gt; 1334:                            1190.15                           5869.06</span></span>
<span><span class="co">#&gt;       102623_UM1848B_JC1_69_1_5017 102623_UM1846B_Media_67_1_5018</span></span>
<span><span class="co">#&gt;                              &lt;num&gt;                          &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:                         0.00                        2168.71</span></span>
<span><span class="co">#&gt;    2:                         0.00                       20194.55</span></span>
<span><span class="co">#&gt;    3:                         0.00                       19457.70</span></span>
<span><span class="co">#&gt;    4:                         0.00                        5966.08</span></span>
<span><span class="co">#&gt;    5:                         0.00                        5674.10</span></span>
<span><span class="co">#&gt;   ---                                                            </span></span>
<span><span class="co">#&gt; 1330:                         0.00                           0.00</span></span>
<span><span class="co">#&gt; 1331:                         0.00                           0.00</span></span>
<span><span class="co">#&gt; 1332:                     13961.88                        9107.94</span></span>
<span><span class="co">#&gt; 1333:                      1364.87                           0.00</span></span>
<span><span class="co">#&gt; 1334:                      1404.99                        1636.15</span></span>
<span><span class="co">#&gt;       102623_UM1847B_JC28_68_1_5019 102623_UM1850B_ANGDT_71_1_5020</span></span>
<span><span class="co">#&gt;                               &lt;num&gt;                          &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:                       5505.94                        3762.47</span></span>
<span><span class="co">#&gt;    2:                          0.00                           0.00</span></span>
<span><span class="co">#&gt;    3:                          0.00                           0.00</span></span>
<span><span class="co">#&gt;    4:                          0.00                           0.00</span></span>
<span><span class="co">#&gt;    5:                          0.00                           0.00</span></span>
<span><span class="co">#&gt;   ---                                                             </span></span>
<span><span class="co">#&gt; 1330:                      17782.36                        7420.76</span></span>
<span><span class="co">#&gt; 1331:                      37742.99                           0.00</span></span>
<span><span class="co">#&gt; 1332:                      30362.90                       28691.15</span></span>
<span><span class="co">#&gt; 1333:                       5510.67                        4081.40</span></span>
<span><span class="co">#&gt; 1334:                      15933.62                        2995.29</span></span>
<span><span class="co">#&gt;       102623_UM1849B_ANG18_70_1_5021 102623_UM1852B_Coculture_72_1_5022</span></span>
<span><span class="co">#&gt;                                &lt;num&gt;                              &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:                        3424.76                            4890.84</span></span>
<span><span class="co">#&gt;    2:                           0.00                               0.00</span></span>
<span><span class="co">#&gt;    3:                           0.00                               0.00</span></span>
<span><span class="co">#&gt;    4:                           0.00                               0.00</span></span>
<span><span class="co">#&gt;    5:                           0.00                               0.00</span></span>
<span><span class="co">#&gt;   ---                                                                  </span></span>
<span><span class="co">#&gt; 1330:                           0.00                           28742.16</span></span>
<span><span class="co">#&gt; 1331:                           0.00                           27778.21</span></span>
<span><span class="co">#&gt; 1332:                       11211.29                           18412.55</span></span>
<span><span class="co">#&gt; 1333:                        1096.25                               0.00</span></span>
<span><span class="co">#&gt; 1334:                        1350.04                            1429.84</span></span>
<span><span class="co">#&gt;       102623_MixedMonoculture_84_1_5028 102623_UM1848B_JC1_69_1_5030</span></span>
<span><span class="co">#&gt;                                   &lt;num&gt;                        &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:                           2870.98                         0.00</span></span>
<span><span class="co">#&gt;    2:                              0.00                         0.00</span></span>
<span><span class="co">#&gt;    3:                            651.95                         0.00</span></span>
<span><span class="co">#&gt;    4:                              0.00                         0.00</span></span>
<span><span class="co">#&gt;    5:                              0.00                         0.00</span></span>
<span><span class="co">#&gt;   ---                                                               </span></span>
<span><span class="co">#&gt; 1330:                           7830.13                         0.00</span></span>
<span><span class="co">#&gt; 1331:                          39217.34                     40432.41</span></span>
<span><span class="co">#&gt; 1332:                          20650.23                     15504.38</span></span>
<span><span class="co">#&gt; 1333:                           1604.38                      1643.83</span></span>
<span><span class="co">#&gt; 1334:                           5398.81                       982.25</span></span>
<span><span class="co">#&gt;       102623_UM1846B_Media_67_1_5031 102623_UM1847B_JC28_68_1_5032</span></span>
<span><span class="co">#&gt;                                &lt;num&gt;                         &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:                        2033.65                       5522.76</span></span>
<span><span class="co">#&gt;    2:                       18650.07                          0.00</span></span>
<span><span class="co">#&gt;    3:                       19542.19                          0.00</span></span>
<span><span class="co">#&gt;    4:                        6755.31                          0.00</span></span>
<span><span class="co">#&gt;    5:                        5971.36                          0.00</span></span>
<span><span class="co">#&gt;   ---                                                             </span></span>
<span><span class="co">#&gt; 1330:                           0.00                      18990.44</span></span>
<span><span class="co">#&gt; 1331:                       40989.54                      36259.55</span></span>
<span><span class="co">#&gt; 1332:                        8683.32                      29340.12</span></span>
<span><span class="co">#&gt; 1333:                           0.00                       5323.67</span></span>
<span><span class="co">#&gt; 1334:                        1791.72                      16808.92</span></span>
<span><span class="co">#&gt;       102623_UM1850B_ANGDT_71_1_5033 102623_UM1849B_ANG18_70_1_5034</span></span>
<span><span class="co">#&gt;                                &lt;num&gt;                          &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:                        3446.13                        3621.36</span></span>
<span><span class="co">#&gt;    2:                           0.00                           0.00</span></span>
<span><span class="co">#&gt;    3:                           0.00                           0.00</span></span>
<span><span class="co">#&gt;    4:                           0.00                           0.00</span></span>
<span><span class="co">#&gt;    5:                           0.00                           0.00</span></span>
<span><span class="co">#&gt;   ---                                                              </span></span>
<span><span class="co">#&gt; 1330:                        8203.37                           0.00</span></span>
<span><span class="co">#&gt; 1331:                           0.00                       38269.77</span></span>
<span><span class="co">#&gt; 1332:                       27768.08                       11750.24</span></span>
<span><span class="co">#&gt; 1333:                        4578.46                        1073.26</span></span>
<span><span class="co">#&gt; 1334:                        3039.45                        1120.35</span></span>
<span><span class="co">#&gt;       102623_UM1852B_Coculture_72_1_5035 102623_MixedMonoculture_84_1_5041</span></span>
<span><span class="co">#&gt;                                    &lt;num&gt;                             &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:                            5051.84                           3028.24</span></span>
<span><span class="co">#&gt;    2:                               0.00                            399.02</span></span>
<span><span class="co">#&gt;    3:                               0.00                            664.81</span></span>
<span><span class="co">#&gt;    4:                               0.00                              0.00</span></span>
<span><span class="co">#&gt;    5:                               0.00                              0.00</span></span>
<span><span class="co">#&gt;   ---                                                                     </span></span>
<span><span class="co">#&gt; 1330:                           29868.13                           8723.55</span></span>
<span><span class="co">#&gt; 1331:                           22049.76                          38174.90</span></span>
<span><span class="co">#&gt; 1332:                           18710.25                          21920.51</span></span>
<span><span class="co">#&gt; 1333:                               0.00                           1213.00</span></span>
<span><span class="co">#&gt; 1334:                            1306.39                           5012.83</span></span>
<span><span class="co">#&gt;       102423_Blank_77_1_5095 102423_Blank_77_2_5096 102423_Blank_77_3_5097</span></span>
<span><span class="co">#&gt;                        &lt;num&gt;                  &lt;num&gt;                  &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:                   0.00                      0                   0.00</span></span>
<span><span class="co">#&gt;    2:                   0.00                      0                   0.00</span></span>
<span><span class="co">#&gt;    3:                   0.00                      0                   0.00</span></span>
<span><span class="co">#&gt;    4:                   0.00                      0                   0.00</span></span>
<span><span class="co">#&gt;    5:                   0.00                      0                   0.00</span></span>
<span><span class="co">#&gt;   ---                                                                     </span></span>
<span><span class="co">#&gt; 1330:                   0.00                      0                   0.00</span></span>
<span><span class="co">#&gt; 1331:               20155.81                      0               35516.44</span></span>
<span><span class="co">#&gt; 1332:                   0.00                      0                   0.00</span></span>
<span><span class="co">#&gt; 1333:                   0.00                      0                   0.00</span></span>
<span><span class="co">#&gt; 1334:                   0.00                      0                   0.00</span></span>
<span><span class="co">#&gt;           kmd</span></span>
<span><span class="co">#&gt;         &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1: 0.08831</span></span>
<span><span class="co">#&gt;    2: 0.29214</span></span>
<span><span class="co">#&gt;    3: 0.22763</span></span>
<span><span class="co">#&gt;    4: 0.18421</span></span>
<span><span class="co">#&gt;    5: 0.19945</span></span>
<span><span class="co">#&gt;   ---        </span></span>
<span><span class="co">#&gt; 1330: 0.31820</span></span>
<span><span class="co">#&gt; 1331: 0.27097</span></span>
<span><span class="co">#&gt; 1332: 0.17696</span></span>
<span><span class="co">#&gt; 1333: 0.17758</span></span>
<span><span class="co">#&gt; 1334: 0.39806</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="accessing-data-in-mpactr-object">Accessing data in mpactr object<a class="anchor" aria-label="anchor" href="#accessing-data-in-mpactr-object"></a>
</h2>
<p>You can extract the peak table or metadata at any point with
<code><a href="../reference/get_raw_data.html">get_raw_data()</a></code>, <code><a href="../reference/get_peak_table.html">get_peak_table()</a></code> and
<code><a href="../reference/get_meta_data.html">get_meta_data()</a></code> functions. Both functions will return a
<code>data.table</code> object with the corresponding information.</p>
<div class="section level3">
<h3 id="extract-peak-table">Extract peak table<a class="anchor" aria-label="anchor" href="#extract-peak-table"></a>
</h3>
<p>The raw peak table is the unfiltered peak table used as input to
mpactr. To extract the raw input peak table, use the function
<code><a href="../reference/get_raw_data.html">get_raw_data()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_raw_data.html">get_raw_data</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span></span>
<span><span class="co">#&gt;    Compound       mz        rt 102623_UM1848B_JC1_69_1_5004</span></span>
<span><span class="co">#&gt;       &lt;num&gt;    &lt;num&gt;     &lt;num&gt;                        &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:        1 256.0883 0.7748333                         0.00</span></span>
<span><span class="co">#&gt; 2:        2 484.2921 0.7756667                       546.56</span></span>
<span><span class="co">#&gt; 3:        3 445.2276 0.7786667                         0.00</span></span>
<span><span class="co">#&gt; 4:        4 354.1842 0.7786667                         0.00</span></span>
<span><span class="co">#&gt; 5:        5 353.1995 0.7816667                         0.00</span></span>
<span><span class="co">#&gt;    102623_UM1846B_Media_67_1_5005 102623_UM1847B_JC28_68_1_5006</span></span>
<span><span class="co">#&gt;                             &lt;num&gt;                         &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:                           0.00                       5358.26</span></span>
<span><span class="co">#&gt; 2:                       16389.28                          0.00</span></span>
<span><span class="co">#&gt; 3:                       22515.28                          0.00</span></span>
<span><span class="co">#&gt; 4:                        6086.35                          0.00</span></span>
<span><span class="co">#&gt; 5:                        5923.96                          0.00</span></span>
<span><span class="co">#&gt;    102623_UM1850B_ANGDT_71_1_5007 102623_UM1849B_ANG18_70_1_5008</span></span>
<span><span class="co">#&gt;                             &lt;num&gt;                          &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:                         4131.4                        3398.08</span></span>
<span><span class="co">#&gt; 2:                            0.0                           0.00</span></span>
<span><span class="co">#&gt; 3:                            0.0                        1641.70</span></span>
<span><span class="co">#&gt; 4:                            0.0                           0.00</span></span>
<span><span class="co">#&gt; 5:                            0.0                           0.00</span></span></code></pre></div>
<p>The raw peak table will not change as filters are applied to the
data. If you want to extract the filtered peak table, with filters that
have been applied, use <code><a href="../reference/get_peak_table.html">get_peak_table()</a></code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_peak_table.html">get_peak_table</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span></span>
<span><span class="co">#&gt;    Compound       mz        rt 102623_UM1848B_JC1_69_1_5004</span></span>
<span><span class="co">#&gt;      &lt;char&gt;    &lt;num&gt;     &lt;num&gt;                        &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:        1 256.0883 0.7748333                         0.00</span></span>
<span><span class="co">#&gt; 2:        2 484.2921 0.7756667                       546.56</span></span>
<span><span class="co">#&gt; 3:        3 445.2276 0.7786667                         0.00</span></span>
<span><span class="co">#&gt; 4:        4 354.1842 0.7786667                         0.00</span></span>
<span><span class="co">#&gt; 5:        5 353.1995 0.7816667                         0.00</span></span>
<span><span class="co">#&gt;    102623_UM1846B_Media_67_1_5005 102623_UM1847B_JC28_68_1_5006</span></span>
<span><span class="co">#&gt;                             &lt;num&gt;                         &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:                           0.00                       5358.26</span></span>
<span><span class="co">#&gt; 2:                       16389.28                          0.00</span></span>
<span><span class="co">#&gt; 3:                       22515.28                          0.00</span></span>
<span><span class="co">#&gt; 4:                        6086.35                          0.00</span></span>
<span><span class="co">#&gt; 5:                        5923.96                          0.00</span></span>
<span><span class="co">#&gt;    102623_UM1850B_ANGDT_71_1_5007 102623_UM1849B_ANG18_70_1_5008</span></span>
<span><span class="co">#&gt;                             &lt;num&gt;                          &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:                         4131.4                        3398.08</span></span>
<span><span class="co">#&gt; 2:                            0.0                           0.00</span></span>
<span><span class="co">#&gt; 3:                            0.0                        1641.70</span></span>
<span><span class="co">#&gt; 4:                            0.0                           0.00</span></span>
<span><span class="co">#&gt; 5:                            0.0                           0.00</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="extract-metadata">Extract metadata<a class="anchor" aria-label="anchor" href="#extract-metadata"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_meta_data.html">get_meta_data</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;                         Injection Sample_Code Biological_Group dilution</span></span>
<span><span class="co">#&gt;                            &lt;char&gt;      &lt;char&gt;           &lt;char&gt;    &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:   102623_UM1848B_JC1_69_1_5004     UM1848B              JC1        1</span></span>
<span><span class="co">#&gt; 2: 102623_UM1846B_Media_67_1_5005     UM1846B            Media        1</span></span>
<span><span class="co">#&gt; 3:  102623_UM1847B_JC28_68_1_5006     UM1847B             JC28        1</span></span>
<span><span class="co">#&gt; 4: 102623_UM1850B_ANGDT_71_1_5007     UM1850B            ANGDT        1</span></span>
<span><span class="co">#&gt; 5: 102623_UM1849B_ANG18_70_1_5008     UM1849B            ANG18        1</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="reference-semantics">Reference semantics<a class="anchor" aria-label="anchor" href="#reference-semantics"></a>
</h2>
<p>mpactr is built on an R6 class-system, meaning it operates on
reference semantics in which data is updated <em>in-place</em>. Compared
to a shallow copy, where only data pointers are copied, or a deep copy,
where the entire data object is copied in memory, any changes to the
original data object, regardless if they are assigned to a new object,
result in changes to the original data object. We can see this
below.</p>
<p>Where the raw data object has 1334 ions in the feature table:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_data.html">import_data</a></span><span class="op">(</span><span class="fu"><a href="../reference/example.html">example</a></span><span class="op">(</span><span class="st">"cultures_peak_table.csv"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/example.html">example</a></span><span class="op">(</span><span class="st">"cultures_metadata.csv"</span><span class="op">)</span>,</span>
<span>  format <span class="op">=</span> <span class="st">"Progenesis"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="../reference/get_peak_table.html">get_peak_table</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt;       Compound       mz         rt 102623_UM1848B_JC1_69_1_5004</span></span>
<span><span class="co">#&gt;         &lt;char&gt;    &lt;num&gt;      &lt;num&gt;                        &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:        1 256.0883  0.7748333                         0.00</span></span>
<span><span class="co">#&gt;    2:        2 484.2921  0.7756667                       546.56</span></span>
<span><span class="co">#&gt;    3:        3 445.2276  0.7786667                         0.00</span></span>
<span><span class="co">#&gt;    4:        4 354.1842  0.7786667                         0.00</span></span>
<span><span class="co">#&gt;    5:        5 353.1995  0.7816667                         0.00</span></span>
<span><span class="co">#&gt;   ---                                                          </span></span>
<span><span class="co">#&gt; 1330:     1330 538.3182 11.4396667                         0.00</span></span>
<span><span class="co">#&gt; 1331:     1331 424.2710 11.4315000                         0.00</span></span>
<span><span class="co">#&gt; 1332:     1332 422.1770 11.4568333                     10655.27</span></span>
<span><span class="co">#&gt; 1333:     1333 422.1776 11.4528333                       923.77</span></span>
<span><span class="co">#&gt; 1334:     1334 538.3981 11.4811667                      1176.19</span></span>
<span><span class="co">#&gt;       102623_UM1846B_Media_67_1_5005</span></span>
<span><span class="co">#&gt;                                &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:                           0.00</span></span>
<span><span class="co">#&gt;    2:                       16389.28</span></span>
<span><span class="co">#&gt;    3:                       22515.28</span></span>
<span><span class="co">#&gt;    4:                        6086.35</span></span>
<span><span class="co">#&gt;    5:                        5923.96</span></span>
<span><span class="co">#&gt;   ---                               </span></span>
<span><span class="co">#&gt; 1330:                           0.00</span></span>
<span><span class="co">#&gt; 1331:                           0.00</span></span>
<span><span class="co">#&gt; 1332:                        5737.01</span></span>
<span><span class="co">#&gt; 1333:                           0.00</span></span>
<span><span class="co">#&gt; 1334:                        1353.96</span></span></code></pre></div>
<p>We can run the <code>filter_mispicked_ions</code> filter, with
default setting <code>copy_object = FALSE</code> (operates on reference
semantics).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data2_mispicked</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_mispicked_ions.html">filter_mispicked_ions</a></span><span class="op">(</span><span class="va">data2</span>,</span>
<span>  ringwin <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  isowin <span class="op">=</span> <span class="fl">0.01</span>, trwin <span class="op">=</span> <span class="fl">0.005</span>,</span>
<span>  max_iso_shift <span class="op">=</span> <span class="fl">3</span>, merge_peaks <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  merge_method <span class="op">=</span> <span class="st">"sum"</span>,</span>
<span>  copy_object <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Checking 1334 peaks for mispicked peaks.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Argument merge_peaks is: TRUE. Merging mispicked peaks with method sum.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 73 ions failed the mispicked filter, 1261 ions remain.</span></span>
<span></span>
<span><span class="fu"><a href="../reference/get_peak_table.html">get_peak_table</a></span><span class="op">(</span><span class="va">data2_mispicked</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt; Key: &lt;Compound, mz, kmd, rt&gt;</span></span>
<span><span class="co">#&gt;       Compound       mz     kmd        rt 102423_Blank_77_1_5095</span></span>
<span><span class="co">#&gt;         &lt;char&gt;    &lt;num&gt;   &lt;num&gt;     &lt;num&gt;                  &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:        1 256.0883 0.08831 0.7748333                      0</span></span>
<span><span class="co">#&gt;    2:       10 340.2040 0.20399 0.7916667                      0</span></span>
<span><span class="co">#&gt;    3:      100 557.1519 0.15191 3.6925000                      0</span></span>
<span><span class="co">#&gt;    4:     1000 278.0638 0.06382 5.5228333                      0</span></span>
<span><span class="co">#&gt;    5:     1001 296.0736 0.07365 5.5246667                      0</span></span>
<span><span class="co">#&gt;   ---                                                           </span></span>
<span><span class="co">#&gt; 1257:      995 561.2726 0.27255 5.4810000                      0</span></span>
<span><span class="co">#&gt; 1258:      996 228.1430 0.14305 5.4818333                      0</span></span>
<span><span class="co">#&gt; 1259:      997 425.1873 0.18726 5.4640000                      0</span></span>
<span><span class="co">#&gt; 1260:      998 337.1987 0.19873 5.4818333                      0</span></span>
<span><span class="co">#&gt; 1261:      999 640.3299 0.32993 5.4596667                      0</span></span></code></pre></div>
<p>This results in 1261 ions in the feature table (above). Even though
we created an object called <code>data2_mispicked</code>, the original
<code>data2</code> object was also updated and now has 1261 ions in the
feature table:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_peak_table.html">get_peak_table</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt; Key: &lt;Compound, mz, kmd, rt&gt;</span></span>
<span><span class="co">#&gt;       Compound       mz     kmd        rt 102423_Blank_77_1_5095</span></span>
<span><span class="co">#&gt;         &lt;char&gt;    &lt;num&gt;   &lt;num&gt;     &lt;num&gt;                  &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:        1 256.0883 0.08831 0.7748333                      0</span></span>
<span><span class="co">#&gt;    2:       10 340.2040 0.20399 0.7916667                      0</span></span>
<span><span class="co">#&gt;    3:      100 557.1519 0.15191 3.6925000                      0</span></span>
<span><span class="co">#&gt;    4:     1000 278.0638 0.06382 5.5228333                      0</span></span>
<span><span class="co">#&gt;    5:     1001 296.0736 0.07365 5.5246667                      0</span></span>
<span><span class="co">#&gt;   ---                                                           </span></span>
<span><span class="co">#&gt; 1257:      995 561.2726 0.27255 5.4810000                      0</span></span>
<span><span class="co">#&gt; 1258:      996 228.1430 0.14305 5.4818333                      0</span></span>
<span><span class="co">#&gt; 1259:      997 425.1873 0.18726 5.4640000                      0</span></span>
<span><span class="co">#&gt; 1260:      998 337.1987 0.19873 5.4818333                      0</span></span>
<span><span class="co">#&gt; 1261:      999 640.3299 0.32993 5.4596667                      0</span></span></code></pre></div>
<p>We recommend using the default <code>copy_object = FALSE</code> as
this makes for an extremely fast and memory-efficient way to chain
mpactr filters together (see <strong>Chaining filters together</strong>
section and <a href="articles/reference_semantics.html">Reference
Semantics</a>); however, if you would like to run the filters
individually with traditional R style objects, you can set
<code>copy_object</code> to <code>TRUE</code> as shown in the filter
examples.</p>
</div>
<div class="section level2">
<h2 id="filtering">Filtering<a class="anchor" aria-label="anchor" href="#filtering"></a>
</h2>
<p>mpactr provides filters to correct for the following issues observed
during preprocessing of tandem MS/MS data:</p>
<ul>
<li>mispicked ions: isotopic patterns that are incorrectly split during
preprocessing.</li>
<li>solvent blank contamination: removal of features present in solvent
blanks due to carryover between samples.</li>
<li>background components: features whose abundance is greater than
user-defined abundance threshold in a specific group of samples, for
example media blanks.</li>
<li>non-reproducible ions: those that are inconsistent between technical
replicates.</li>
<li>insource ions: fragment ions created during ionization before
fragmentation in the tandem MS/MS workflow.</li>
</ul>
<div class="section level4">
<h4 id="mispicked-ions-filter">Mispicked ions filter<a class="anchor" aria-label="anchor" href="#mispicked-ions-filter"></a>
</h4>
<p>To check for mispicked ions, use mpactr function
<code><a href="../reference/filter_mispicked_ions.html">filter_mispicked_ions()</a></code>. This function takes an
<code>mpactr object</code> as input, and checks for similar ions with
the arguments <code>ringwin</code>, <code>isowin</code>,
<code>trwin</code> and <code>max_iso_shift</code>.</p>
<p>Ions in the feature table are flagged as similar based on retention
time and mass. Flagged ion groups are suggested to be the result of
incorrect splitting of isotopic patterns during peak picking, detector
saturation artifacts, or incorrect identification of multiply charged
oligomers.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_mispicked</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_mispicked_ions.html">filter_mispicked_ions</a></span><span class="op">(</span><span class="va">data</span>,</span>
<span>  ringwin <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  isowin <span class="op">=</span> <span class="fl">0.01</span>, trwin <span class="op">=</span> <span class="fl">0.005</span>,</span>
<span>  max_iso_shift <span class="op">=</span> <span class="fl">3</span>, merge_peaks <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  merge_method <span class="op">=</span> <span class="st">"sum"</span>,</span>
<span>  copy_object <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Checking 1334 peaks for mispicked peaks.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Argument merge_peaks is: TRUE. Merging mispicked peaks with method sum.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 73 ions failed the mispicked filter, 1261 ions remain.</span></span></code></pre></div>
<p>Each filter reports progress of filtering, here we can see that 1334
ions were present prior to checking for mispicked ions. 73 ions were
found to be similar to another ion and following merging, 1261 ions
remain.</p>
<p>If you are interested in the groups of similar ions flagged in this
filter, you can use <code><a href="../reference/get_similar_ions.html">get_similar_ions()</a></code>. This function
returns a <code>data.table</code> reporting the main ion (the ion
retained post-merging) and the ions similar to it.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_similar_ions.html">get_similar_ions</a></span><span class="op">(</span><span class="va">data_mispicked</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    main_ion similar_ions</span></span>
<span><span class="co">#&gt;      &lt;char&gt;       &lt;list&gt;</span></span>
<span><span class="co">#&gt; 1:     1188         1189</span></span>
<span><span class="co">#&gt; 2:      939          945</span></span>
<span><span class="co">#&gt; 3:      898          896</span></span>
<span><span class="co">#&gt; 4:     1214         1210</span></span>
<span><span class="co">#&gt; 5:     1253         1249</span></span>
<span><span class="co">#&gt; 6:      886          884</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="remove-ions-that-are-above-a-threshold-in-one-biological-group">Remove ions that are above a threshold in one biological group<a class="anchor" aria-label="anchor" href="#remove-ions-that-are-above-a-threshold-in-one-biological-group"></a>
</h4>
<p>Removing solvent blank impurities is important for correcting for
between-sample carryover and contamination in experimental samples. You
can identify and remove these ions with mpactr’s
<code><a href="../reference/filter_group.html">filter_group()</a></code> function. <code><a href="../reference/filter_group.html">filter_group()</a></code>
identifies ions above a relative abundance threshold
(<code>group_threshold</code>) in a specific group
(<code>group_to_remove</code>). To remove solvent blank impurities, set
<code>group_to_remove</code> to the <code>Biological_Group</code> in
your metadata file which corresponds to your solvent blank samples, here
“Solvent_Blank”.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_blank</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_group.html">filter_group</a></span><span class="op">(</span><span class="va">data</span>,</span>
<span>  group_threshold <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  group_to_remove <span class="op">=</span> <span class="st">"Solvent_Blank"</span>, remove_ions <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  copy_object <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Parsing 1334 peaks based on the sample group: Solvent_Blank.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Argument remove_ions is: TRUE.Removing peaks from Solvent_Blank.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 26 ions failed the Solvent_Blank filter, 1308 ions remain.</span></span></code></pre></div>
<p>In this example, 1334 ions were present prior to the group filter. 26
ions were found to be above the relative abundance threshold of 0.01 in
“Solvent_Blank” samples, leaving 1308 ions in the peak table.</p>
<p>We can also use this filter to remove ions from other groups, such as
media blanks. This can be useful for experiments on cell cultures. The
example data contains samples belonging to the
<code>Biological_Group</code> “Media”. These samples are from media
blanks, which are negative controls from the growth experiments
conducted in this study. We can remove features whose abundance is
greater than 1% of the largest group in media blank samples by
specifying <code>group_to_remove</code> = “Media”. We recommend removing
media blank ions following all other filters so all high-quality ions
are identified (see Chaining filters together below).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_media_blank</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_group.html">filter_group</a></span><span class="op">(</span><span class="va">data</span>,</span>
<span>  group_threshold <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  group_to_remove <span class="op">=</span> <span class="st">"Media"</span>, remove_ions <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  copy_object <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Parsing 1334 peaks based on the sample group: Media.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Argument remove_ions is: TRUE.Removing peaks from Media.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 824 ions failed the Media filter, 510 ions remain.</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="remove-non-reproducible-ions">Remove non-reproducible ions<a class="anchor" aria-label="anchor" href="#remove-non-reproducible-ions"></a>
</h4>
<p>Ions whose abundance are not consisent between technical replicates
(<em>i.e.</em>, non-reproducible) may not be reliable for analysis and
therefore should be removed from the feature table. Non-reproducible
ions are identified by mean or median coefficient of variation (CV)
between technical replicates with <code><a href="../reference/filter_cv.html">filter_cv()</a></code>. Note - this
filter cannot be applied to data that does not contain technical
replicates.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_rep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_cv.html">filter_cv</a></span><span class="op">(</span><span class="va">data</span>,</span>
<span>  cv_threshold <span class="op">=</span> <span class="fl">0.2</span>, cv_param <span class="op">=</span> <span class="st">"median"</span>,</span>
<span>  copy_object <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Parsing 1334 peaks for replicability across technical replicates.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 241 ions failed the cv_filter filter, 1093 ions remain.</span></span></code></pre></div>
<p>In our example dataset, 241 ions were flagged as non-reproducible.
These ions were removed, leaving 1093 ions in the feature table.</p>
<p>If you would like to visualize how the CV threshold performed on your
dataset, you can extract the CV calculated during
<code>filer_cv()</code> using mpactr’s <code><a href="../reference/get_cv_data.html">get_cv_data()</a></code>
function, and calculate the percentage of features for plotting. You can
look at both mean and median CV as shown in the example below, or you
can filter the data by the parameter of choice.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_cv_data.html">get_cv_data</a></span><span class="op">(</span><span class="va">data_rep</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean_cv"</span>, <span class="st">"median_cv"</span><span class="op">)</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"param"</span>,</span>
<span>               values_to <span class="op">=</span> <span class="st">"cv"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="va">param</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">arrange</span>, <span class="va">cv</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">mutate</span>, index <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cv</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">mutate</span>, index_scale <span class="op">=</span> <span class="va">index</span> <span class="op">*</span> <span class="fl">100</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cv</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cv</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">#&gt;   param     data                </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> mean_cv   <span style="color: #949494;">&lt;tibble [1,334 × 4]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> median_cv <span style="color: #949494;">&lt;tibble [1,334 × 4]&gt;</span></span></span></code></pre></div>
<p>The nested data are tibbles with the columns Compound, cv, index,
index_scale:</p>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;   Compound      cv index index_scale</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 455      0.005<span style="text-decoration: underline;">00</span>     0      0     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 364      0.007<span style="text-decoration: underline;">20</span>     1      0.075<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 409      0.007<span style="text-decoration: underline;">87</span>     2      0.150 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 435      0.008<span style="text-decoration: underline;">03</span>     3      0.225 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 1003     0.008<span style="text-decoration: underline;">87</span>     4      0.300 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 1117     0.011<span style="text-decoration: underline;">5</span>      5      0.375</span></span></code></pre>
<p>There is one tibble for each parameter (either mean or median). We
also want to calculate the percentage of features represented by the CV
threshold.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cv_thresh_percent</span> <span class="op">&lt;-</span> <span class="va">cv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">param</span> <span class="op">==</span> <span class="st">"median_cv"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="va">data</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>diff_cv_thresh <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">cv</span> <span class="op">-</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_min</a></span><span class="op">(</span><span class="va">diff_cv_thresh</span>, n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">index_scale</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cv_thresh_percent</span></span>
<span><span class="co">#&gt; [1] 81.85907</span></span></code></pre></div>
<p>Then we can plot percentage of features by CV:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="va">data</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">param</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean_cv"</span>, <span class="st">"median_cv"</span><span class="op">)</span>,</span>
<span>                        labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"median"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">cv</span>, y <span class="op">=</span> <span class="va">index_scale</span>, group <span class="op">=</span> <span class="va">param</span>, color <span class="op">=</span> <span class="va">param</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"darkgrey"</span>,</span>
<span>             linetype <span class="op">=</span> <span class="st">"dashed"</span>,</span>
<span>             linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">cv_thresh_percent</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"darkgrey"</span>,</span>
<span>             linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"CV"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Percentage of Features"</span>,</span>
<span>       param <span class="op">=</span> <span class="st">"Statistic"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,</span>
<span>    axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"inside"</span>,</span>
<span>    legend.position.inside <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.90</span>, <span class="fl">.08</span><span class="op">)</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Ignoring unknown labels:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> <span style="color: #00BB00;">param</span> : <span style="color: #0000BB;">"Statistic"</span></span></span></code></pre></div>
<p><img src="filter_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<p>Here we can see that roughly 80% of features were below the CV
threshold meaning 20% were removed at a CV threshold of 0.2.</p>
</div>
<div class="section level4">
<h4 id="remove-insource-fragment-ions">Remove insource fragment ions<a class="anchor" aria-label="anchor" href="#remove-insource-fragment-ions"></a>
</h4>
<p>Some mass species can be fragmented during ionization in tandem
MS/MS, creating insource ions. This can result in ions from one compound
being represented more than once in the feature table. If you would like
to remove insource ions fragments, you can do so with mpactr’s
<code><a href="../reference/filter_insource_ions.html">filter_insource_ions()</a></code>. <code><a href="../reference/filter_insource_ions.html">filter_insource_ions()</a></code>
conducts ion deconvolution via retention time correlation matrices
within MS1 scans. Highly correlated ion groups are determined by the
<code>cluster_threshold</code> parameter and filtered to remove the low
mass features. The highest mass feature is identified as the likely
precursor ion and retained in the feature table.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_insource</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_insource_ions.html">filter_insource_ions</a></span><span class="op">(</span><span class="va">data</span>,</span>
<span>  cluster_threshold <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  copy_object <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Parsing 1334 peaks for insource ions.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 72 ions failed the insource filter, 1262 ions remain.</span></span></code></pre></div>
<p>72 ions were identified and removed during deconvolution of this
dataset, leaving 1262 ions in the feature table.</p>
</div>
<div class="section level4">
<h4 id="chaining-filters-together">Chaining filters together<a class="anchor" aria-label="anchor" href="#chaining-filters-together"></a>
</h4>
<p>Filters can be chained in a customizable workflow, shown below. While
filters can be chained in any order, we recommend filtering mispicked
ions, then solvent blanks, prior to filtering non-repoducible or
insource ions. This will allow for incorrectly picked peaks to be merged
and any contamination/carryover removed prior to identifying
non-reproducible and insource fragment ions. Here we also demonstrate
the removal of media blank components with the
<code><a href="../reference/filter_group.html">filter_group()</a></code> function after identification of
high-quality ions.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_data.html">import_data</a></span><span class="op">(</span><span class="fu"><a href="../reference/example.html">example</a></span><span class="op">(</span><span class="st">"cultures_peak_table.csv"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/example.html">example</a></span><span class="op">(</span><span class="st">"cultures_metadata.csv"</span><span class="op">)</span>,</span>
<span>  format <span class="op">=</span> <span class="st">"Progenesis"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_filtered</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_mispicked_ions.html">filter_mispicked_ions</a></span><span class="op">(</span><span class="va">data</span>, merge_method <span class="op">=</span> <span class="st">"sum"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/filter_group.html">filter_group</a></span><span class="op">(</span>group_to_remove <span class="op">=</span> <span class="st">"Solvent_Blank"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/filter_cv.html">filter_cv</a></span><span class="op">(</span>cv_threshold <span class="op">=</span> <span class="fl">0.2</span>, cv_param <span class="op">=</span> <span class="st">"median"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/filter_group.html">filter_group</a></span><span class="op">(</span>group_to_remove <span class="op">=</span> <span class="st">"Media"</span><span class="op">)</span> </span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Checking 1334 peaks for mispicked peaks.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Argument merge_peaks is: TRUE. Merging mispicked peaks with method sum.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 73 ions failed the mispicked filter, 1261 ions remain.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Parsing 1261 peaks based on the sample group: Solvent_Blank.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Argument remove_ions is: TRUE.Removing peaks from Solvent_Blank.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 25 ions failed the Solvent_Blank filter, 1236 ions remain.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Parsing 1236 peaks for replicability across technical replicates.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 214 ions failed the cv_filter filter, 1022 ions remain.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Parsing 1022 peaks based on the sample group: Media.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Argument remove_ions is: TRUE.Removing peaks from Media.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 599 ions failed the Media filter, 423 ions remain.</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>mpactr offers mutliple ways to view a summary of data filtering.</p>
<div class="section level4">
<h4 id="view-passing-and-failed-ions-for-a-single-filter">View passing and failed ions for a single filter<a class="anchor" aria-label="anchor" href="#view-passing-and-failed-ions-for-a-single-filter"></a>
</h4>
<p>If you are interested in viewing the passing and failing ions for a
single filter, use the <code><a href="../reference/filter_summary.html">filter_summary()</a></code> function. You must
specify which filter you are intested in, either “mispicked”, “group”,
“replicability”, or “insource”.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mispicked_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_summary.html">filter_summary</a></span><span class="op">(</span><span class="va">data_filtered</span>, filter <span class="op">=</span> <span class="st">"mispicked"</span><span class="op">)</span></span></code></pre></div>
<p>Failed ions:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mispicked_summary</span><span class="op">$</span><span class="va">failed_ions</span></span>
<span><span class="co">#&gt;  [1] "1189" "945"  "896"  "1210" "1249" "884"  "1060" "1008" "1304" "1271"</span></span>
<span><span class="co">#&gt; [11] "1326" "1333" "937"  "1250" "1196" "1014" "895"  "1228" "817"  "853" </span></span>
<span><span class="co">#&gt; [21] "1122" "938"  "743"  "1145" "1021" "946"  "161"  "1032" "1033" "282" </span></span>
<span><span class="co">#&gt; [31] "154"  "779"  "1254" "1224" "260"  "264"  "18"   "1012" "800"  "1251"</span></span>
<span><span class="co">#&gt; [41] "901"  "969"  "1259" "1223" "528"  "1095" "927"  "1242" "410"  "1260"</span></span>
<span><span class="co">#&gt; [51] "427"  "1157" "1206" "393"  "1252" "1204" "975"  "584"  "1282" "1090"</span></span>
<span><span class="co">#&gt; [61] "1257" "507"  "1087" "1153" "1261" "371"  "373"  "340"  "1267" "546" </span></span>
<span><span class="co">#&gt; [71] "495"  "1289" "1290"</span></span></code></pre></div>
<p>Passing ions:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mispicked_summary</span><span class="op">$</span><span class="va">passed_ions</span>, <span class="fl">100</span><span class="op">)</span></span>
<span><span class="co">#&gt;   [1] "1"    "10"   "100"  "1000" "1001" "1002" "1003" "1004" "1005" "1006"</span></span>
<span><span class="co">#&gt;  [11] "1007" "1009" "101"  "1010" "1011" "1013" "1015" "1016" "1017" "1018"</span></span>
<span><span class="co">#&gt;  [21] "1019" "102"  "1020" "1022" "1023" "1024" "1025" "1026" "1027" "1028"</span></span>
<span><span class="co">#&gt;  [31] "1029" "103"  "1030" "1031" "1034" "1035" "1036" "1037" "1038" "1039"</span></span>
<span><span class="co">#&gt;  [41] "104"  "1040" "1041" "1042" "1043" "1044" "1045" "1046" "1047" "1048"</span></span>
<span><span class="co">#&gt;  [51] "1049" "105"  "1050" "1051" "1052" "1053" "1054" "1055" "1056" "1057"</span></span>
<span><span class="co">#&gt;  [61] "1058" "1059" "106"  "1061" "1062" "1063" "1064" "1065" "1066" "1067"</span></span>
<span><span class="co">#&gt;  [71] "1068" "1069" "107"  "1070" "1071" "1072" "1073" "1074" "1075" "1076"</span></span>
<span><span class="co">#&gt;  [81] "1077" "1078" "1079" "108"  "1080" "1081" "1082" "1083" "1084" "1085"</span></span>
<span><span class="co">#&gt;  [91] "1086" "1088" "1089" "109"  "1091" "1092" "1093" "1094" "1096" "1097"</span></span></code></pre></div>
<p>If you set <code>filter</code> to a filter name that you did not
apply to your data, an error message will be returned.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/filter_summary.html">filter_summary</a></span><span class="op">(</span><span class="va">data_filtered</span>, filter <span class="op">=</span> <span class="st">"insource"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `mpactr_object$get_log()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> `filter` insource has not yet been applied to the data. Run the</span></span>
<span><span class="co">#&gt;   corresponding filter function prior to extracting the summary.</span></span></code></pre></div>
<p>If you want to retrieve the filter summary for the group filter, you
must also supply the group name with the <code>group</code>
argument:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/filter_summary.html">filter_summary</a></span><span class="op">(</span><span class="va">data_filtered</span>, filter <span class="op">=</span> <span class="st">"group"</span>, group <span class="op">=</span> <span class="st">"Solvent_Blank"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $failed_ions</span></span>
<span><span class="co">#&gt;  [1] "1275" "1324" "1325" "1330" "1331" "684"  "697"  "698"  "709"  "713" </span></span>
<span><span class="co">#&gt; [11] "714"  "717"  "720"  "725"  "730"  "731"  "735"  "736"  "737"  "740" </span></span>
<span><span class="co">#&gt; [21] "747"  "750"  "752"  "754"  "755" </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $passed_ions</span></span>
<span><span class="co">#&gt;    [1] "1"    "10"   "100"  "1000" "1001" "1002" "1003" "1004" "1005" "1006"</span></span>
<span><span class="co">#&gt;   [11] "1007" "1009" "101"  "1010" "1011" "1013" "1015" "1016" "1017" "1018"</span></span>
<span><span class="co">#&gt;   [21] "1019" "102"  "1020" "1022" "1023" "1024" "1025" "1026" "1027" "1028"</span></span>
<span><span class="co">#&gt;   [31] "1029" "103"  "1030" "1031" "1034" "1035" "1036" "1037" "1038" "1039"</span></span>
<span><span class="co">#&gt;   [41] "104"  "1040" "1041" "1042" "1043" "1044" "1045" "1046" "1047" "1048"</span></span>
<span><span class="co">#&gt;   [51] "1049" "105"  "1050" "1051" "1052" "1053" "1054" "1055" "1056" "1057"</span></span>
<span><span class="co">#&gt;   [61] "1058" "1059" "106"  "1061" "1062" "1063" "1064" "1065" "1066" "1067"</span></span>
<span><span class="co">#&gt;   [71] "1068" "1069" "107"  "1070" "1071" "1072" "1073" "1074" "1075" "1076"</span></span>
<span><span class="co">#&gt;   [81] "1077" "1078" "1079" "108"  "1080" "1081" "1082" "1083" "1084" "1085"</span></span>
<span><span class="co">#&gt;   [91] "1086" "1088" "1089" "109"  "1091" "1092" "1093" "1094" "1096" "1097"</span></span>
<span><span class="co">#&gt;  [101] "1098" "1099" "11"   "110"  "1100" "1101" "1102" "1103" "1104" "1105"</span></span>
<span><span class="co">#&gt;  [111] "1106" "1107" "1108" "1109" "111"  "1110" "1111" "1112" "1113" "1114"</span></span>
<span><span class="co">#&gt;  [121] "1115" "1116" "1117" "1118" "1119" "112"  "1120" "1121" "1123" "1124"</span></span>
<span><span class="co">#&gt;  [131] "1125" "1126" "1127" "1128" "1129" "113"  "1130" "1131" "1132" "1133"</span></span>
<span><span class="co">#&gt;  [141] "1134" "1135" "1136" "1137" "1138" "1139" "114"  "1140" "1141" "1142"</span></span>
<span><span class="co">#&gt;  [151] "1143" "1144" "1146" "1147" "1148" "1149" "115"  "1150" "1151" "1152"</span></span>
<span><span class="co">#&gt;  [161] "1154" "1155" "1156" "1158" "1159" "116"  "1160" "1161" "1162" "1163"</span></span>
<span><span class="co">#&gt;  [171] "1164" "1165" "1166" "1167" "1168" "1169" "117"  "1170" "1171" "1172"</span></span>
<span><span class="co">#&gt;  [181] "1173" "1174" "1175" "1176" "1177" "1178" "1179" "118"  "1180" "1181"</span></span>
<span><span class="co">#&gt;  [191] "1182" "1183" "1184" "1185" "1186" "1187" "1188" "119"  "1190" "1191"</span></span>
<span><span class="co">#&gt;  [201] "1192" "1193" "1194" "1195" "1197" "1198" "1199" "12"   "120"  "1200"</span></span>
<span><span class="co">#&gt;  [211] "1201" "1202" "1203" "1205" "1207" "1208" "1209" "121"  "1211" "1212"</span></span>
<span><span class="co">#&gt;  [221] "1213" "1214" "1215" "1216" "1217" "1218" "1219" "122"  "1220" "1221"</span></span>
<span><span class="co">#&gt;  [231] "1222" "1225" "1226" "1227" "1229" "123"  "1230" "1231" "1232" "1233"</span></span>
<span><span class="co">#&gt;  [241] "1234" "1235" "1236" "1237" "1238" "1239" "124"  "1240" "1241" "1243"</span></span>
<span><span class="co">#&gt;  [251] "1244" "1245" "1246" "1247" "1248" "125"  "1253" "1255" "1256" "1258"</span></span>
<span><span class="co">#&gt;  [261] "126"  "1262" "1263" "1264" "1265" "1266" "1268" "1269" "127"  "1270"</span></span>
<span><span class="co">#&gt;  [271] "1272" "1273" "1274" "1276" "1277" "1278" "1279" "128"  "1280" "1281"</span></span>
<span><span class="co">#&gt;  [281] "1283" "1284" "1285" "1286" "1287" "1288" "129"  "1291" "1292" "1293"</span></span>
<span><span class="co">#&gt;  [291] "1294" "1295" "1296" "1297" "1298" "1299" "13"   "130"  "1300" "1301"</span></span>
<span><span class="co">#&gt;  [301] "1302" "1303" "1305" "1306" "1307" "1308" "1309" "131"  "1310" "1311"</span></span>
<span><span class="co">#&gt;  [311] "1312" "1313" "1314" "1315" "1316" "1317" "1318" "1319" "132"  "1320"</span></span>
<span><span class="co">#&gt;  [321] "1321" "1322" "1323" "1327" "1328" "1329" "133"  "1332" "1334" "134" </span></span>
<span><span class="co">#&gt;  [331] "135"  "136"  "137"  "138"  "139"  "14"   "140"  "141"  "142"  "143" </span></span>
<span><span class="co">#&gt;  [341] "144"  "145"  "146"  "147"  "148"  "149"  "15"   "150"  "151"  "152" </span></span>
<span><span class="co">#&gt;  [351] "153"  "155"  "156"  "157"  "158"  "159"  "16"   "160"  "162"  "163" </span></span>
<span><span class="co">#&gt;  [361] "164"  "165"  "166"  "167"  "168"  "169"  "17"   "170"  "171"  "172" </span></span>
<span><span class="co">#&gt;  [371] "173"  "174"  "175"  "176"  "177"  "178"  "179"  "180"  "181"  "182" </span></span>
<span><span class="co">#&gt;  [381] "183"  "184"  "185"  "186"  "187"  "188"  "189"  "19"   "190"  "191" </span></span>
<span><span class="co">#&gt;  [391] "192"  "193"  "194"  "195"  "196"  "197"  "198"  "199"  "2"    "20"  </span></span>
<span><span class="co">#&gt;  [401] "200"  "201"  "202"  "203"  "204"  "205"  "206"  "207"  "208"  "209" </span></span>
<span><span class="co">#&gt;  [411] "21"   "210"  "211"  "212"  "213"  "214"  "215"  "216"  "217"  "218" </span></span>
<span><span class="co">#&gt;  [421] "219"  "22"   "220"  "221"  "222"  "223"  "224"  "225"  "226"  "227" </span></span>
<span><span class="co">#&gt;  [431] "228"  "229"  "23"   "230"  "231"  "232"  "233"  "234"  "235"  "236" </span></span>
<span><span class="co">#&gt;  [441] "237"  "238"  "239"  "24"   "240"  "241"  "242"  "243"  "244"  "245" </span></span>
<span><span class="co">#&gt;  [451] "246"  "247"  "248"  "249"  "25"   "250"  "251"  "252"  "253"  "254" </span></span>
<span><span class="co">#&gt;  [461] "255"  "256"  "257"  "258"  "259"  "26"   "261"  "262"  "263"  "265" </span></span>
<span><span class="co">#&gt;  [471] "266"  "267"  "268"  "269"  "27"   "270"  "271"  "272"  "273"  "274" </span></span>
<span><span class="co">#&gt;  [481] "275"  "276"  "277"  "278"  "279"  "28"   "280"  "281"  "283"  "284" </span></span>
<span><span class="co">#&gt;  [491] "285"  "286"  "287"  "288"  "289"  "29"   "290"  "291"  "292"  "293" </span></span>
<span><span class="co">#&gt;  [501] "294"  "295"  "296"  "297"  "298"  "299"  "3"    "30"   "300"  "301" </span></span>
<span><span class="co">#&gt;  [511] "302"  "303"  "304"  "305"  "306"  "307"  "308"  "309"  "31"   "310" </span></span>
<span><span class="co">#&gt;  [521] "311"  "312"  "313"  "314"  "315"  "316"  "317"  "318"  "319"  "32"  </span></span>
<span><span class="co">#&gt;  [531] "320"  "321"  "322"  "323"  "324"  "325"  "326"  "327"  "328"  "329" </span></span>
<span><span class="co">#&gt;  [541] "33"   "330"  "331"  "332"  "333"  "334"  "335"  "336"  "337"  "338" </span></span>
<span><span class="co">#&gt;  [551] "339"  "34"   "341"  "342"  "343"  "344"  "345"  "346"  "347"  "348" </span></span>
<span><span class="co">#&gt;  [561] "349"  "35"   "350"  "351"  "352"  "353"  "354"  "355"  "356"  "357" </span></span>
<span><span class="co">#&gt;  [571] "358"  "359"  "36"   "360"  "361"  "362"  "363"  "364"  "365"  "366" </span></span>
<span><span class="co">#&gt;  [581] "367"  "368"  "369"  "37"   "370"  "372"  "374"  "375"  "376"  "377" </span></span>
<span><span class="co">#&gt;  [591] "378"  "379"  "38"   "380"  "381"  "382"  "383"  "384"  "385"  "386" </span></span>
<span><span class="co">#&gt;  [601] "387"  "388"  "389"  "39"   "390"  "391"  "392"  "394"  "395"  "396" </span></span>
<span><span class="co">#&gt;  [611] "397"  "398"  "399"  "4"    "40"   "400"  "401"  "402"  "403"  "404" </span></span>
<span><span class="co">#&gt;  [621] "405"  "406"  "407"  "408"  "409"  "41"   "411"  "412"  "413"  "414" </span></span>
<span><span class="co">#&gt;  [631] "415"  "416"  "417"  "418"  "419"  "42"   "420"  "421"  "422"  "423" </span></span>
<span><span class="co">#&gt;  [641] "424"  "425"  "426"  "428"  "429"  "43"   "430"  "431"  "432"  "433" </span></span>
<span><span class="co">#&gt;  [651] "434"  "435"  "436"  "437"  "438"  "439"  "44"   "440"  "441"  "442" </span></span>
<span><span class="co">#&gt;  [661] "443"  "444"  "445"  "446"  "447"  "448"  "449"  "45"   "450"  "451" </span></span>
<span><span class="co">#&gt;  [671] "452"  "453"  "454"  "455"  "456"  "457"  "458"  "459"  "46"   "460" </span></span>
<span><span class="co">#&gt;  [681] "461"  "462"  "463"  "464"  "465"  "466"  "467"  "468"  "469"  "47"  </span></span>
<span><span class="co">#&gt;  [691] "470"  "471"  "472"  "473"  "474"  "475"  "476"  "477"  "478"  "479" </span></span>
<span><span class="co">#&gt;  [701] "48"   "480"  "481"  "482"  "483"  "484"  "485"  "486"  "487"  "488" </span></span>
<span><span class="co">#&gt;  [711] "489"  "49"   "490"  "491"  "492"  "493"  "494"  "496"  "497"  "498" </span></span>
<span><span class="co">#&gt;  [721] "499"  "5"    "50"   "500"  "501"  "502"  "503"  "504"  "505"  "506" </span></span>
<span><span class="co">#&gt;  [731] "508"  "509"  "51"   "510"  "511"  "512"  "513"  "514"  "515"  "516" </span></span>
<span><span class="co">#&gt;  [741] "517"  "518"  "519"  "52"   "520"  "521"  "522"  "523"  "524"  "525" </span></span>
<span><span class="co">#&gt;  [751] "526"  "527"  "529"  "53"   "530"  "531"  "532"  "533"  "534"  "535" </span></span>
<span><span class="co">#&gt;  [761] "536"  "537"  "538"  "539"  "54"   "540"  "541"  "542"  "543"  "544" </span></span>
<span><span class="co">#&gt;  [771] "545"  "547"  "548"  "549"  "55"   "550"  "551"  "552"  "553"  "554" </span></span>
<span><span class="co">#&gt;  [781] "555"  "556"  "557"  "558"  "559"  "56"   "560"  "561"  "562"  "563" </span></span>
<span><span class="co">#&gt;  [791] "564"  "565"  "566"  "567"  "568"  "569"  "57"   "570"  "571"  "572" </span></span>
<span><span class="co">#&gt;  [801] "573"  "574"  "575"  "576"  "577"  "578"  "579"  "58"   "580"  "581" </span></span>
<span><span class="co">#&gt;  [811] "582"  "583"  "585"  "586"  "587"  "588"  "589"  "59"   "590"  "591" </span></span>
<span><span class="co">#&gt;  [821] "592"  "593"  "594"  "595"  "596"  "597"  "598"  "599"  "6"    "60"  </span></span>
<span><span class="co">#&gt;  [831] "600"  "601"  "602"  "603"  "604"  "605"  "606"  "607"  "608"  "609" </span></span>
<span><span class="co">#&gt;  [841] "61"   "610"  "611"  "612"  "613"  "614"  "615"  "616"  "617"  "618" </span></span>
<span><span class="co">#&gt;  [851] "619"  "62"   "620"  "621"  "622"  "623"  "624"  "625"  "626"  "627" </span></span>
<span><span class="co">#&gt;  [861] "628"  "629"  "63"   "630"  "631"  "632"  "633"  "634"  "635"  "636" </span></span>
<span><span class="co">#&gt;  [871] "637"  "638"  "639"  "64"   "640"  "641"  "642"  "643"  "644"  "645" </span></span>
<span><span class="co">#&gt;  [881] "646"  "647"  "648"  "649"  "65"   "650"  "651"  "652"  "653"  "654" </span></span>
<span><span class="co">#&gt;  [891] "655"  "656"  "657"  "658"  "659"  "66"   "660"  "661"  "662"  "663" </span></span>
<span><span class="co">#&gt;  [901] "664"  "665"  "666"  "667"  "668"  "669"  "67"   "670"  "671"  "672" </span></span>
<span><span class="co">#&gt;  [911] "673"  "674"  "675"  "676"  "677"  "678"  "679"  "68"   "680"  "681" </span></span>
<span><span class="co">#&gt;  [921] "682"  "683"  "685"  "686"  "687"  "688"  "689"  "69"   "690"  "691" </span></span>
<span><span class="co">#&gt;  [931] "692"  "693"  "694"  "695"  "696"  "699"  "7"    "70"   "700"  "701" </span></span>
<span><span class="co">#&gt;  [941] "702"  "703"  "704"  "705"  "706"  "707"  "708"  "71"   "710"  "711" </span></span>
<span><span class="co">#&gt;  [951] "712"  "715"  "716"  "718"  "719"  "72"   "721"  "722"  "723"  "724" </span></span>
<span><span class="co">#&gt;  [961] "726"  "727"  "728"  "729"  "73"   "732"  "733"  "734"  "738"  "739" </span></span>
<span><span class="co">#&gt;  [971] "74"   "741"  "742"  "744"  "745"  "746"  "748"  "749"  "75"   "751" </span></span>
<span><span class="co">#&gt;  [981] "753"  "756"  "757"  "758"  "759"  "76"   "760"  "761"  "762"  "763" </span></span>
<span><span class="co">#&gt;  [991] "764"  "765"  "766"  "767"  "768"  "769"  "77"   "770"  "771"  "772" </span></span>
<span><span class="co">#&gt; [1001] "773"  "774"  "775"  "776"  "777"  "778"  "78"   "780"  "781"  "782" </span></span>
<span><span class="co">#&gt; [1011] "783"  "784"  "785"  "786"  "787"  "788"  "789"  "79"   "790"  "791" </span></span>
<span><span class="co">#&gt; [1021] "792"  "793"  "794"  "795"  "796"  "797"  "798"  "799"  "8"    "80"  </span></span>
<span><span class="co">#&gt; [1031] "801"  "802"  "803"  "804"  "805"  "806"  "807"  "808"  "809"  "81"  </span></span>
<span><span class="co">#&gt; [1041] "810"  "811"  "812"  "813"  "814"  "815"  "816"  "818"  "819"  "82"  </span></span>
<span><span class="co">#&gt; [1051] "820"  "821"  "822"  "823"  "824"  "825"  "826"  "827"  "828"  "829" </span></span>
<span><span class="co">#&gt; [1061] "83"   "830"  "831"  "832"  "833"  "834"  "835"  "836"  "837"  "838" </span></span>
<span><span class="co">#&gt; [1071] "839"  "84"   "840"  "841"  "842"  "843"  "844"  "845"  "846"  "847" </span></span>
<span><span class="co">#&gt; [1081] "848"  "849"  "85"   "850"  "851"  "852"  "854"  "855"  "856"  "857" </span></span>
<span><span class="co">#&gt; [1091] "858"  "859"  "86"   "860"  "861"  "862"  "863"  "864"  "865"  "866" </span></span>
<span><span class="co">#&gt; [1101] "867"  "868"  "869"  "87"   "870"  "871"  "872"  "873"  "874"  "875" </span></span>
<span><span class="co">#&gt; [1111] "876"  "877"  "878"  "879"  "88"   "880"  "881"  "882"  "883"  "885" </span></span>
<span><span class="co">#&gt; [1121] "886"  "887"  "888"  "889"  "89"   "890"  "891"  "892"  "893"  "894" </span></span>
<span><span class="co">#&gt; [1131] "897"  "898"  "899"  "9"    "90"   "900"  "902"  "903"  "904"  "905" </span></span>
<span><span class="co">#&gt; [1141] "906"  "907"  "908"  "909"  "91"   "910"  "911"  "912"  "913"  "914" </span></span>
<span><span class="co">#&gt; [1151] "915"  "916"  "917"  "918"  "919"  "92"   "920"  "921"  "922"  "923" </span></span>
<span><span class="co">#&gt; [1161] "924"  "925"  "926"  "928"  "929"  "93"   "930"  "931"  "932"  "933" </span></span>
<span><span class="co">#&gt; [1171] "934"  "935"  "936"  "939"  "94"   "940"  "941"  "942"  "943"  "944" </span></span>
<span><span class="co">#&gt; [1181] "947"  "948"  "949"  "95"   "950"  "951"  "952"  "953"  "954"  "955" </span></span>
<span><span class="co">#&gt; [1191] "956"  "957"  "958"  "959"  "96"   "960"  "961"  "962"  "963"  "964" </span></span>
<span><span class="co">#&gt; [1201] "965"  "966"  "967"  "968"  "97"   "970"  "971"  "972"  "973"  "974" </span></span>
<span><span class="co">#&gt; [1211] "976"  "977"  "978"  "979"  "98"   "980"  "981"  "982"  "983"  "984" </span></span>
<span><span class="co">#&gt; [1221] "985"  "986"  "987"  "988"  "989"  "99"   "990"  "991"  "992"  "993" </span></span>
<span><span class="co">#&gt; [1231] "994"  "995"  "996"  "997"  "998"  "999"</span></span></code></pre></div>
<p><code>group</code> must always be supplied for this filter, even if
only one group filter has been applied.</p>
</div>
<div class="section level4">
<h4 id="view-passing-and-failed-ions-for-all-input-ions">View passing and failed ions for all input ions<a class="anchor" aria-label="anchor" href="#view-passing-and-failed-ions-for-all-input-ions"></a>
</h4>
<p>You can view the filtering status of all input ions with the
<code><a href="../reference/qc_summary.html">qc_summary()</a></code> function. A data.table reporting the compound
id (<code>compounds</code>) and if it failed or passed filtering. If the
ion failed filtering, its status will report the name of the filter it
failed.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/qc_summary.html">qc_summary</a></span><span class="op">(</span><span class="va">data_filtered</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">compounds</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;         status compounds</span></span>
<span><span class="co">#&gt;         &lt;char&gt;    &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1: group-Media         1</span></span>
<span><span class="co">#&gt; 2: group-Media        10</span></span>
<span><span class="co">#&gt; 3: group-Media       100</span></span>
<span><span class="co">#&gt; 4:      Passed      1000</span></span>
<span><span class="co">#&gt; 5:      Passed      1001</span></span>
<span><span class="co">#&gt; 6:      Passed      1002</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="visualize-filtering-qc-with-tree-map-plot">Visualize filtering QC with tree map plot<a class="anchor" aria-label="anchor" href="#visualize-filtering-qc-with-tree-map-plot"></a>
</h4>
<p>You can visualize filtering results with a tree map using the
filtering summary obtained from <code><a href="../reference/qc_summary.html">qc_summary()</a></code> and the
packages <code>ggplot2</code> and <code>treemapify</code>.</p>
<p>First, we need to determine the number of ions for each ion status in
the summary table. You can report the count; however, we need to
calculate the percent of ions in each group. We have done this in the
code chunk below, where we have used <code>data.table</code> syntax as
the <code><a href="../reference/qc_summary.html">qc_summary()</a></code> returns a <code>data.table</code> object.
If you are not familiar with the package data.table, check out their
resources on <a href="https://rdatatable.gitlab.io/data.table/" class="external-link">gitlab</a>.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkox.org/treemapify/" class="external-link">treemapify</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ion_counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/qc_summary.html">qc_summary</a></span><span class="op">(</span><span class="va">data_filtered</span><span class="op">)</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>count <span class="op">=</span> <span class="va">.N</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">status</span><span class="op">]</span><span class="op">[</span></span>
<span>  , <span class="va">percent</span> <span class="op">:=</span> <span class="op">(</span><span class="va">count</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="op">]</span></span></code></pre></div>
<p>Finally, we plot the treemap:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ion_counts</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>area <span class="op">=</span> <span class="va">percent</span>, fill <span class="op">=</span> <span class="va">status</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://wilkox.org/treemapify/reference/geom_treemap.html" class="external-link">geom_treemap</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://wilkox.org/treemapify/reference/geom_treemap_text.html" class="external-link">geom_treemap_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">status</span>, <span class="va">count</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">percent</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"%)"</span><span class="op">)</span>,</span>
<span>                  sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span>,</span>
<span>    fontface <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bold"</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tm</span></span></code></pre></div>
<p><img src="filter_files/figure-html/unnamed-chunk-29-1.png" width="700"></p>
<p>This plot can be customized with ggplot2, for example we only want to
display the percentage:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ion_counts</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>area <span class="op">=</span> <span class="va">percent</span>, fill <span class="op">=</span> <span class="va">status</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://wilkox.org/treemapify/reference/geom_treemap.html" class="external-link">geom_treemap</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://wilkox.org/treemapify/reference/geom_treemap_text.html" class="external-link">geom_treemap_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">status</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">percent</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"%)"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span>,</span>
<span>    fontface <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bold"</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tm</span></span></code></pre></div>
<p><img src="filter_files/figure-html/unnamed-chunk-30-1.png" width="700"></p>
<p>Or you no longer need the legend and maybe we want custom colors:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tm</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Greens"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<p><img src="filter_files/figure-html/unnamed-chunk-31-1.png" width="700"></p>
<p>If you want a fast visualization of the treemap, you can pass the
mpactr object to the function <code><a href="../reference/plot_qc_tree.html">plot_qc_tree()</a></code>.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_qc_tree.html">plot_qc_tree</a></span><span class="op">(</span><span class="va">data_filtered</span><span class="op">)</span></span></code></pre></div>
<p><img src="filter_files/figure-html/unnamed-chunk-32-1.png" width="700"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Allison Mason, Gregory Johnson, Patrick Schloss.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
