<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Filter with mpact original data • mpactr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Filter with mpact original data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mpactr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/reference_semantics.html">Reference Semantics</a></li>
    <li><a class="dropdown-item" href="../articles/filter2.html">Filter</a></li>
    <li><a class="dropdown-item" href="../articles/downstream_analyses.html">Additional Analyses</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mums2/mpactr"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Filter with mpact original data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mums2/mpactr/blob/main/vignettes/articles/filter2.Rmd" class="external-link"><code>vignettes/articles/filter2.Rmd</code></a></small>
      <div class="d-none name"><code>filter2.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># library(mpactr)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mums2.github.io/mpactr/">mpactr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="load-data-into-r">Load data into R<a class="anchor" aria-label="anchor" href="#load-data-into-r"></a>
</h2>
<p>mpactr requires 2 files as imput: a feature table and metadata file.
Both are expected to be comma separated files (<em>.csv</em>).</p>
<ol style="list-style-type: decimal">
<li>peak_table: a peak table in Progenesis format is expected. To export
a compatable peak table in Progenesis, navigate to the <em>Review
Compounds</em> tab then File -&gt; Export Compound Measurements. Select
the following properties: Compound, m/z, Retention time (min), and Raw
abundance and click ok.</li>
<li>metadata: a table with sample information. At minimum the following
columns are expected: Injection, Sample_Code, Biological_Group.
Injection is the sample name and is expected to match sample column
names in the peak_table. Sample_Code is the id for technical replicate
groups. Biological_Group is the id for biological replicate groups.
Other sample metadata can be added, and is encouraged for downstream
analysis following filtering with mpactr.</li>
</ol>
<p>To import these data into R, use the mpactr function
<code><a href="../reference/import_data.html">import_data()</a></code>, which has the arguments:
<code>peak_table_file_path</code> and <code>meta_data_file_path</code>.
This tutorial will show you examples with data from the original mpact
program, found on <a href="https://github.com/BalunasLab/mpact/tree/main/rawdata/PTY087I2" class="external-link">GitHub</a>.
This dataset contain 38 samples for biological groups solvent blanks,
media blanks, Streptomyces sp. PTY08712 grown with (250um_Ce) and
without (0um_Ce) rare earth element cerium. For more information about
the experiments conducted see <a href="https://pubs.acs.org/doi/abs/10.1021/acs.analchem.2c04632" class="external-link">Samples,
Puckett, and Balunas 2023</a>.</p>
<p>The original program has sample metadata split across two files: the
sample list and metadata. mpactr accepts a single file, so we need to
combine these in one prior to import with
<code><a href="../reference/import_data.html">import_data()</a></code>.</p>
<p>Load the sample list and metadata files.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">samplelist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/BalunasLab/mpact/main/rawdata/PTY087I2/samplelist.csv"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">38</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">8</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span>  (4): Injection, MS method, LC method, Sample_Code</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span>  (1): Injection volume</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">lgl</span>  (2): File Text, Sample_Notes</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">time</span> (1): Vial_Position</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/BalunasLab/mpact/main/rawdata/PTY087I2/extractmetadata.csv"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">10</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">4</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span> (4): Sample_Code, Organism, Biological_Group, Extract_Notes</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre></div>
<p>Our sample list contains additional blank samples that are not in the
feature table, and therefore should be removed prior to import.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/BalunasLab/mpact/main/rawdata/PTY087I2/200826_PTY087I2codingdataset.csv"</span>, skip <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_subset.html" class="external-link">str_subset</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"200826"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">4956</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">33</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span>  (1): Compound</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (32): m/z, Retention time (min), 200826_blank1_r1, 200826_blank1_r2, 200...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span></span>
<span><span class="va">meta_data</span> <span class="op">&lt;-</span> <span class="va">samplelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">metadata</span>, by <span class="op">=</span> <span class="st">"Sample_Code"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Injection</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">samples</span><span class="op">)</span></span></code></pre></div>
<p>Now we can import the data. We will provide the url for the
<code>peak_table</code>, and our reformatted meta_data object. This peak
table was exported from Progenesis, so we will set the
<code>format</code> argument to Progenesis.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_data.html">import_data</a></span><span class="op">(</span>peak_table <span class="op">=</span> <span class="st">"https://raw.githubusercontent.com/BalunasLab/mpact/main/rawdata/PTY087I2/200826_PTY087I2codingdataset.csv"</span>,</span>
<span>  meta_data <span class="op">=</span> <span class="va">meta_data</span>,</span>
<span>  format <span class="op">=</span> <span class="st">"Progenesis"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This will create an R6 class object, which will store both the peak
table and metadata.</p>
<p>Calling the new mpactr object will print the current peak table in
the terminal:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span></span>
<span><span class="co">#&gt;               Compound       mz        rt 200826_blank1_r1 200826_blank1_r2</span></span>
<span><span class="co">#&gt;                 &lt;char&gt;    &lt;num&gt;     &lt;num&gt;            &lt;num&gt;            &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:   0.80_418.1451n 419.1521 0.8027667          0.00000         0.000000</span></span>
<span><span class="co">#&gt;    2: 0.81_210.0803m/z 210.0803 0.8099167          0.00000         0.000000</span></span>
<span><span class="co">#&gt;    3:   4.11_444.1061n 889.2190 4.1109833          0.00000         0.000000</span></span>
<span><span class="co">#&gt;    4:   4.11_400.0799n 401.0872 4.1109833          0.00000         0.000000</span></span>
<span><span class="co">#&gt;    5:   0.80_627.2171n 650.2063 0.8027667          0.00000         0.000000</span></span>
<span><span class="co">#&gt;   ---                                                                      </span></span>
<span><span class="co">#&gt; 4952: 8.95_740.1659m/z 740.1659 8.9477667         50.86249         0.000000</span></span>
<span><span class="co">#&gt; 4953: 9.94_801.6828m/z 801.6828 9.9434667         11.08239         1.229457</span></span>
<span><span class="co">#&gt; 4954: 8.45_702.2132m/z 702.2132 8.4499000        257.47905        38.155170</span></span>
<span><span class="co">#&gt; 4955: 8.35_664.5170m/z 664.5170 8.3506167        284.44529       291.579543</span></span>
<span><span class="co">#&gt; 4956: 8.88_467.1028m/z 467.1028 8.8770500       2150.74323         0.000000</span></span>
<span><span class="co">#&gt;       200826_blank1_r3 200826_PTY087I2_0umce1_r1 200826_PTY087I2_0umce1_r2</span></span>
<span><span class="co">#&gt;                  &lt;num&gt;                     &lt;num&gt;                     &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:       0.00000000              3.020244e+05              3.056620e+05</span></span>
<span><span class="co">#&gt;    2:       0.00000000              1.655825e+05              1.668336e+05</span></span>
<span><span class="co">#&gt;    3:       0.00000000              3.401869e+04              3.530162e+04</span></span>
<span><span class="co">#&gt;    4:       0.00000000              4.358187e+04              4.370543e+04</span></span>
<span><span class="co">#&gt;    5:       0.00000000              4.332639e+04              4.388268e+04</span></span>
<span><span class="co">#&gt;   ---                                                                     </span></span>
<span><span class="co">#&gt; 4952:       0.00000000              4.148686e+01              7.871277e+00</span></span>
<span><span class="co">#&gt; 4953:       9.07128542              9.266055e-02              1.530647e-01</span></span>
<span><span class="co">#&gt; 4954:       0.00000000              1.732118e+03              0.000000e+00</span></span>
<span><span class="co">#&gt; 4955:       0.01844371              3.013042e+01              3.180264e+01</span></span>
<span><span class="co">#&gt; 4956:       0.00000000              0.000000e+00              1.028675e+03</span></span>
<span><span class="co">#&gt;       200826_PTY087I2_0umce1_r3 200826_PTY087I2_0umce2_r1</span></span>
<span><span class="co">#&gt;                           &lt;num&gt;                     &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:              3.101702e+05              2.978810e+05</span></span>
<span><span class="co">#&gt;    2:              1.675075e+05              1.625522e+05</span></span>
<span><span class="co">#&gt;    3:              3.543251e+04              2.000822e+04</span></span>
<span><span class="co">#&gt;    4:              4.357772e+04              3.155634e+04</span></span>
<span><span class="co">#&gt;    5:              4.557824e+04              4.335971e+04</span></span>
<span><span class="co">#&gt;   ---                                                    </span></span>
<span><span class="co">#&gt; 4952:              0.000000e+00              5.231151e-01</span></span>
<span><span class="co">#&gt; 4953:              3.667251e-01              0.000000e+00</span></span>
<span><span class="co">#&gt; 4954:              0.000000e+00              1.925907e+03</span></span>
<span><span class="co">#&gt; 4955:              3.135295e+01              3.848152e+01</span></span>
<span><span class="co">#&gt; 4956:              0.000000e+00              0.000000e+00</span></span>
<span><span class="co">#&gt;       200826_PTY087I2_0umce2_r2 200826_PTY087I2_0umce2_r3</span></span>
<span><span class="co">#&gt;                           &lt;num&gt;                     &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:              3.035890e+05              302993.80270</span></span>
<span><span class="co">#&gt;    2:              1.647463e+05              163903.73400</span></span>
<span><span class="co">#&gt;    3:              2.005072e+04               20880.29986</span></span>
<span><span class="co">#&gt;    4:              3.127270e+04               32045.00687</span></span>
<span><span class="co">#&gt;    5:              4.480789e+04               44925.54654</span></span>
<span><span class="co">#&gt;   ---                                                    </span></span>
<span><span class="co">#&gt; 4952:              0.000000e+00                   0.00000</span></span>
<span><span class="co">#&gt; 4953:              4.336638e+00                  16.76814</span></span>
<span><span class="co">#&gt; 4954:              0.000000e+00                   0.00000</span></span>
<span><span class="co">#&gt; 4955:              3.330928e+01                  39.86223</span></span>
<span><span class="co">#&gt; 4956:              1.324812e+03                   0.00000</span></span>
<span><span class="co">#&gt;       200826_PTY087I2_0umce3_r1 200826_PTY087I2_0umce3_r2</span></span>
<span><span class="co">#&gt;                           &lt;num&gt;                     &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:              302974.58390              303741.67880</span></span>
<span><span class="co">#&gt;    2:              163537.75040              163110.51990</span></span>
<span><span class="co">#&gt;    3:               22257.61067               23254.43336</span></span>
<span><span class="co">#&gt;    4:               32885.51773               34089.23273</span></span>
<span><span class="co">#&gt;    5:               44175.78590               44779.28226</span></span>
<span><span class="co">#&gt;   ---                                                    </span></span>
<span><span class="co">#&gt; 4952:                   0.00000                   0.00000</span></span>
<span><span class="co">#&gt; 4953:                  22.20122                  27.34200</span></span>
<span><span class="co">#&gt; 4954:                3572.79179                   0.00000</span></span>
<span><span class="co">#&gt; 4955:                  40.88535                  31.80185</span></span>
<span><span class="co">#&gt; 4956:                   0.00000                2695.52447</span></span>
<span><span class="co">#&gt;       200826_PTY087I2_0umce3_r3 200826_PTY087I2_250umce1_r1</span></span>
<span><span class="co">#&gt;                           &lt;num&gt;                       &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:              305307.58880                304461.58900</span></span>
<span><span class="co">#&gt;    2:              162538.71820                159919.35920</span></span>
<span><span class="co">#&gt;    3:               23551.62571                115011.92150</span></span>
<span><span class="co">#&gt;    4:               34572.55101                 86989.85992</span></span>
<span><span class="co">#&gt;    5:               45432.68848                 46936.50804</span></span>
<span><span class="co">#&gt;   ---                                                      </span></span>
<span><span class="co">#&gt; 4952:                   0.00000                    10.90783</span></span>
<span><span class="co">#&gt; 4953:                  18.40502                    19.33673</span></span>
<span><span class="co">#&gt; 4954:                   0.00000                  2909.45195</span></span>
<span><span class="co">#&gt; 4955:                  37.87828                    36.48544</span></span>
<span><span class="co">#&gt; 4956:                   0.00000                     0.00000</span></span>
<span><span class="co">#&gt;       200826_PTY087I2_250umce1_r2 200826_PTY087I2_250umce1_r3</span></span>
<span><span class="co">#&gt;                             &lt;num&gt;                       &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:                3.059096e+05                301102.32680</span></span>
<span><span class="co">#&gt;    2:                1.622441e+05                160509.21490</span></span>
<span><span class="co">#&gt;    3:                1.137904e+05                111088.30390</span></span>
<span><span class="co">#&gt;    4:                8.660144e+04                 84092.94428</span></span>
<span><span class="co">#&gt;    5:                4.671744e+04                 44639.13434</span></span>
<span><span class="co">#&gt;   ---                                                        </span></span>
<span><span class="co">#&gt; 4952:                0.000000e+00                     0.00000</span></span>
<span><span class="co">#&gt; 4953:                8.184311e+00                    21.90738</span></span>
<span><span class="co">#&gt; 4954:                0.000000e+00                     0.00000</span></span>
<span><span class="co">#&gt; 4955:                3.628852e+01                    29.76471</span></span>
<span><span class="co">#&gt; 4956:                2.857433e+03                     0.00000</span></span>
<span><span class="co">#&gt;       200826_PTY087I2_250umce2_r1 200826_PTY087I2_250umce2_r2</span></span>
<span><span class="co">#&gt;                             &lt;num&gt;                       &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:                2.950731e+05                294507.85260</span></span>
<span><span class="co">#&gt;    2:                1.569863e+05                157018.74160</span></span>
<span><span class="co">#&gt;    3:                9.171678e+04                 93573.47803</span></span>
<span><span class="co">#&gt;    4:                7.609289e+04                 76935.45726</span></span>
<span><span class="co">#&gt;    5:                4.381261e+04                 44053.75013</span></span>
<span><span class="co">#&gt;   ---                                                        </span></span>
<span><span class="co">#&gt; 4952:                6.760895e+00                     0.00000</span></span>
<span><span class="co">#&gt; 4953:                7.221771e+00                    15.49070</span></span>
<span><span class="co">#&gt; 4954:                3.327218e+03                     0.00000</span></span>
<span><span class="co">#&gt; 4955:                2.518465e+01                    31.12184</span></span>
<span><span class="co">#&gt; 4956:                0.000000e+00                  3328.19867</span></span>
<span><span class="co">#&gt;       200826_PTY087I2_250umce2_r3 200826_PTY087I2_250umce3_r1</span></span>
<span><span class="co">#&gt;                             &lt;num&gt;                       &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:                2.929342e+05                2.965014e+05</span></span>
<span><span class="co">#&gt;    2:                1.581785e+05                1.587843e+05</span></span>
<span><span class="co">#&gt;    3:                9.163425e+04                1.096399e+05</span></span>
<span><span class="co">#&gt;    4:                7.578763e+04                8.364374e+04</span></span>
<span><span class="co">#&gt;    5:                4.269494e+04                4.389627e+04</span></span>
<span><span class="co">#&gt;   ---                                                        </span></span>
<span><span class="co">#&gt; 4952:                0.000000e+00                1.476297e+01</span></span>
<span><span class="co">#&gt; 4953:                9.325017e+00                5.648035e-03</span></span>
<span><span class="co">#&gt; 4954:                2.368871e-02                1.814666e+03</span></span>
<span><span class="co">#&gt; 4955:                3.390672e+01                3.206222e+01</span></span>
<span><span class="co">#&gt; 4956:                0.000000e+00                0.000000e+00</span></span>
<span><span class="co">#&gt;       200826_PTY087I2_250umce3_r2 200826_PTY087I2_250umce3_r3 200826_media1_r1</span></span>
<span><span class="co">#&gt;                             &lt;num&gt;                       &lt;num&gt;            &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:                285505.55760                2.974424e+05     2.554827e+05</span></span>
<span><span class="co">#&gt;    2:                156528.89670                1.580228e+05     1.705910e+05</span></span>
<span><span class="co">#&gt;    3:                105935.69660                1.093869e+05     0.000000e+00</span></span>
<span><span class="co">#&gt;    4:                 82556.23968                8.342072e+04     0.000000e+00</span></span>
<span><span class="co">#&gt;    5:                 40825.92921                4.428666e+04     3.381575e+04</span></span>
<span><span class="co">#&gt;   ---                                                                         </span></span>
<span><span class="co">#&gt; 4952:                     0.00000                0.000000e+00     5.259717e+01</span></span>
<span><span class="co">#&gt; 4953:                     0.00000                1.223522e+00     4.605544e+00</span></span>
<span><span class="co">#&gt; 4954:                     0.00000                0.000000e+00     1.498701e+03</span></span>
<span><span class="co">#&gt; 4955:                    31.94794                4.173415e+01     7.619112e+03</span></span>
<span><span class="co">#&gt; 4956:                  2671.52999                0.000000e+00     2.386338e+02</span></span>
<span><span class="co">#&gt;       200826_media1_r2 200826_media1_r3 200826_media2_r1 200826_media2_r2</span></span>
<span><span class="co">#&gt;                  &lt;num&gt;            &lt;num&gt;            &lt;num&gt;            &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:     2.599233e+05     256021.50590     256086.16490     2.547825e+05</span></span>
<span><span class="co">#&gt;    2:     1.726717e+05     170716.05390     168874.36980     1.676367e+05</span></span>
<span><span class="co">#&gt;    3:     0.000000e+00          0.00000          0.00000     0.000000e+00</span></span>
<span><span class="co">#&gt;    4:     1.431221e-02          0.00000          0.00000     0.000000e+00</span></span>
<span><span class="co">#&gt;    5:     3.397754e+04      33169.47338      34372.98871     3.400355e+04</span></span>
<span><span class="co">#&gt;   ---                                                                    </span></span>
<span><span class="co">#&gt; 4952:     0.000000e+00         83.52441          0.00000     0.000000e+00</span></span>
<span><span class="co">#&gt; 4953:     1.084082e+01          2.18883          8.67406     3.569775e+00</span></span>
<span><span class="co">#&gt; 4954:     0.000000e+00          0.00000         18.25012     0.000000e+00</span></span>
<span><span class="co">#&gt; 4955:     8.962027e+00         48.01832         13.24781     1.311910e+01</span></span>
<span><span class="co">#&gt; 4956:     2.095771e+02          0.00000          0.00000     2.203997e+02</span></span>
<span><span class="co">#&gt;       200826_media2_r3 200826_media3_r1 200826_media3_r2 200826_media3_r3</span></span>
<span><span class="co">#&gt;                  &lt;num&gt;            &lt;num&gt;            &lt;num&gt;            &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:     2.565244e+05     2.601417e+05     2.526247e+05     2.582542e+05</span></span>
<span><span class="co">#&gt;    2:     1.692963e+05     1.695131e+05     1.672526e+05     1.707665e+05</span></span>
<span><span class="co">#&gt;    3:     0.000000e+00     0.000000e+00     0.000000e+00     0.000000e+00</span></span>
<span><span class="co">#&gt;    4:     0.000000e+00     0.000000e+00     0.000000e+00     0.000000e+00</span></span>
<span><span class="co">#&gt;    5:     3.396147e+04     3.518284e+04     3.317613e+04     3.422295e+04</span></span>
<span><span class="co">#&gt;   ---                                                                    </span></span>
<span><span class="co">#&gt; 4952:     0.000000e+00     0.000000e+00     0.000000e+00     0.000000e+00</span></span>
<span><span class="co">#&gt; 4953:     3.475497e+00     2.908507e+00     7.279138e+00     1.909397e+00</span></span>
<span><span class="co">#&gt; 4954:     0.000000e+00     1.539513e+03     3.443881e+01     6.352884e+01</span></span>
<span><span class="co">#&gt; 4955:     1.589438e+01     2.351233e+01     1.777778e+01     2.357445e+01</span></span>
<span><span class="co">#&gt; 4956:     0.000000e+00     0.000000e+00     7.790370e+02     0.000000e+00</span></span>
<span><span class="co">#&gt;             kmd</span></span>
<span><span class="co">#&gt;           &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1: 0.1520828</span></span>
<span><span class="co">#&gt;    2: 0.0803421</span></span>
<span><span class="co">#&gt;    3: 0.2189760</span></span>
<span><span class="co">#&gt;    4: 0.0872034</span></span>
<span><span class="co">#&gt;    5: 0.2063013</span></span>
<span><span class="co">#&gt;   ---          </span></span>
<span><span class="co">#&gt; 4952: 0.1658522</span></span>
<span><span class="co">#&gt; 4953: 0.6828202</span></span>
<span><span class="co">#&gt; 4954: 0.2131724</span></span>
<span><span class="co">#&gt; 4955: 0.5170432</span></span>
<span><span class="co">#&gt; 4956: 0.1028370</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="accessing-data-in-mpactr-object">Accessing data in mpactr object<a class="anchor" aria-label="anchor" href="#accessing-data-in-mpactr-object"></a>
</h2>
<p>You can extract the peak table or metadata at any point with
<code><a href="../reference/get_raw_data.html">get_raw_data()</a></code>, <code><a href="../reference/get_peak_table.html">get_peak_table()</a></code> and
<code><a href="../reference/get_meta_data.html">get_meta_data()</a></code> functions. Both functions will return a
<code>data.table</code> object with the corresponding information.</p>
<div class="section level3">
<h3 id="extract-peak-table">Extract peak table<a class="anchor" aria-label="anchor" href="#extract-peak-table"></a>
</h3>
<p>The raw peak table is the unfiltered peak table used as input to
mpactr. To extract the raw input peak table, use the function
<code><a href="../reference/get_raw_data.html">get_raw_data()</a></code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_raw_data.html">get_raw_data</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span></span>
<span><span class="co">#&gt;            Compound       mz        rt 200826_blank1_r1 200826_blank1_r2</span></span>
<span><span class="co">#&gt;              &lt;char&gt;    &lt;num&gt;     &lt;num&gt;            &lt;num&gt;            &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:   0.80_418.1451n 419.1521 0.8027667                0                0</span></span>
<span><span class="co">#&gt; 2: 0.81_210.0803m/z 210.0803 0.8099167                0                0</span></span>
<span><span class="co">#&gt; 3:   4.11_444.1061n 889.2190 4.1109833                0                0</span></span>
<span><span class="co">#&gt; 4:   4.11_400.0799n 401.0872 4.1109833                0                0</span></span>
<span><span class="co">#&gt; 5:   0.80_627.2171n 650.2063 0.8027667                0                0</span></span>
<span><span class="co">#&gt;    200826_blank1_r3 200826_PTY087I2_0umce1_r1 200826_PTY087I2_0umce1_r2</span></span>
<span><span class="co">#&gt;               &lt;num&gt;                     &lt;num&gt;                     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:                0                 302024.40                 305662.05</span></span>
<span><span class="co">#&gt; 2:                0                 165582.52                 166833.63</span></span>
<span><span class="co">#&gt; 3:                0                  34018.69                  35301.62</span></span>
<span><span class="co">#&gt; 4:                0                  43581.87                  43705.43</span></span>
<span><span class="co">#&gt; 5:                0                  43326.39                  43882.68</span></span></code></pre></div>
<p>The raw peak table will not change as filters are applied to the
data. If you want to extract the filtered peak table, with filters that
have been applied, use <code><a href="../reference/get_peak_table.html">get_peak_table()</a></code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_peak_table.html">get_peak_table</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span></span>
<span><span class="co">#&gt;            Compound       mz        rt 200826_blank1_r1 200826_blank1_r2</span></span>
<span><span class="co">#&gt;              &lt;char&gt;    &lt;num&gt;     &lt;num&gt;            &lt;num&gt;            &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:   0.80_418.1451n 419.1521 0.8027667                0                0</span></span>
<span><span class="co">#&gt; 2: 0.81_210.0803m/z 210.0803 0.8099167                0                0</span></span>
<span><span class="co">#&gt; 3:   4.11_444.1061n 889.2190 4.1109833                0                0</span></span>
<span><span class="co">#&gt; 4:   4.11_400.0799n 401.0872 4.1109833                0                0</span></span>
<span><span class="co">#&gt; 5:   0.80_627.2171n 650.2063 0.8027667                0                0</span></span>
<span><span class="co">#&gt;    200826_blank1_r3 200826_PTY087I2_0umce1_r1 200826_PTY087I2_0umce1_r2</span></span>
<span><span class="co">#&gt;               &lt;num&gt;                     &lt;num&gt;                     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:                0                 302024.40                 305662.05</span></span>
<span><span class="co">#&gt; 2:                0                 165582.52                 166833.63</span></span>
<span><span class="co">#&gt; 3:                0                  34018.69                  35301.62</span></span>
<span><span class="co">#&gt; 4:                0                  43581.87                  43705.43</span></span>
<span><span class="co">#&gt; 5:                0                  43326.39                  43882.68</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="extract-metadata">Extract metadata<a class="anchor" aria-label="anchor" href="#extract-metadata"></a>
</h3>
<p>Metadata can be accessed with <code><a href="../reference/get_meta_data.html">get_meta_data()</a></code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_meta_data.html">get_meta_data</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;           Injection File Text Sample_Notes                     MS method</span></span>
<span><span class="co">#&gt;              &lt;char&gt;    &lt;lgcl&gt;       &lt;lgcl&gt;                        &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1: 200826_blank1_r1        NA           NA RMS20181105_Balunas_11min_mse</span></span>
<span><span class="co">#&gt; 2: 200826_blank1_r2        NA           NA RMS20181105_Balunas_11min_mse</span></span>
<span><span class="co">#&gt; 3: 200826_blank1_r3        NA           NA RMS20181105_Balunas_11min_mse</span></span>
<span><span class="co">#&gt; 4: 200826_media1_r1        NA           NA RMS20181105_Balunas_11min_mse</span></span>
<span><span class="co">#&gt; 5: 200826_media1_r2        NA           NA RMS20181105_Balunas_11min_mse</span></span>
<span><span class="co">#&gt;                                                         LC method Vial_Position</span></span>
<span><span class="co">#&gt;                                                            &lt;char&gt;         &lt;hms&gt;</span></span>
<span><span class="co">#&gt; 1: jlb20170623_Balunas_11minRogermethod_450uLmin_5to98_col3_noPDA      01:16:00</span></span>
<span><span class="co">#&gt; 2: jlb20170623_Balunas_11minRogermethod_450uLmin_5to98_col3_noPDA      01:16:00</span></span>
<span><span class="co">#&gt; 3: jlb20170623_Balunas_11minRogermethod_450uLmin_5to98_col3_noPDA      01:16:00</span></span>
<span><span class="co">#&gt; 4: jlb20170623_Balunas_11minRogermethod_450uLmin_5to98_col3_noPDA      01:01:00</span></span>
<span><span class="co">#&gt; 5: jlb20170623_Balunas_11minRogermethod_450uLmin_5to98_col3_noPDA      01:01:00</span></span>
<span><span class="co">#&gt;    Injection volume Sample_Code  Organism Biological_Group Extract_Notes</span></span>
<span><span class="co">#&gt;               &lt;num&gt;      &lt;char&gt;    &lt;char&gt;           &lt;char&gt;        &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:               10       Blank  50% MeOH           Blanks      50% MeOH</span></span>
<span><span class="co">#&gt; 2:               10       Blank  50% MeOH           Blanks      50% MeOH</span></span>
<span><span class="co">#&gt; 3:               10       Blank  50% MeOH           Blanks      50% MeOH</span></span>
<span><span class="co">#&gt; 4:               10      MB1109 GYM_Media            Media     GYM_Media</span></span>
<span><span class="co">#&gt; 5:               10      MB1109 GYM_Media            Media     GYM_Media</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="reference-semantics">Reference semantics<a class="anchor" aria-label="anchor" href="#reference-semantics"></a>
</h2>
<p>mpactr is built on an R6 class-system, meaning it operates on
reference semantics in which data is updated <em>in-place</em>. Compared
to a shallow copy, where only data pointers are copied, or a deep copy,
where the entire data object is copied in memory, any changes to the
original data object, regardless if they are assigned to a new object,
result in changes to the original data object. We can see this
below.</p>
<p>Where the raw data object has 4956 ions in the feature table:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_data.html">import_data</a></span><span class="op">(</span>peak_table <span class="op">=</span> <span class="st">"https://raw.githubusercontent.com/BalunasLab/mpact/main/rawdata/PTY087I2/200826_PTY087I2codingdataset.csv"</span>,</span>
<span>  meta_data <span class="op">=</span> <span class="va">meta_data</span>,</span>
<span>  format <span class="op">=</span> <span class="st">"Progenesis"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/get_peak_table.html">get_peak_table</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt;               Compound       mz        rt 200826_blank1_r1 200826_blank1_r2</span></span>
<span><span class="co">#&gt;                 &lt;char&gt;    &lt;num&gt;     &lt;num&gt;            &lt;num&gt;            &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:   0.80_418.1451n 419.1521 0.8027667          0.00000         0.000000</span></span>
<span><span class="co">#&gt;    2: 0.81_210.0803m/z 210.0803 0.8099167          0.00000         0.000000</span></span>
<span><span class="co">#&gt;    3:   4.11_444.1061n 889.2190 4.1109833          0.00000         0.000000</span></span>
<span><span class="co">#&gt;    4:   4.11_400.0799n 401.0872 4.1109833          0.00000         0.000000</span></span>
<span><span class="co">#&gt;    5:   0.80_627.2171n 650.2063 0.8027667          0.00000         0.000000</span></span>
<span><span class="co">#&gt;   ---                                                                      </span></span>
<span><span class="co">#&gt; 4952: 8.95_740.1659m/z 740.1659 8.9477667         50.86249         0.000000</span></span>
<span><span class="co">#&gt; 4953: 9.94_801.6828m/z 801.6828 9.9434667         11.08239         1.229457</span></span>
<span><span class="co">#&gt; 4954: 8.45_702.2132m/z 702.2132 8.4499000        257.47905        38.155170</span></span>
<span><span class="co">#&gt; 4955: 8.35_664.5170m/z 664.5170 8.3506167        284.44529       291.579543</span></span>
<span><span class="co">#&gt; 4956: 8.88_467.1028m/z 467.1028 8.8770500       2150.74323         0.000000</span></span></code></pre></div>
<p>We can run the <code>filter_mispicked_ions</code> filter, with
default setting <code>copy_object = FALSE</code> (operates on reference
semantics).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data2_mispicked</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_mispicked_ions.html">filter_mispicked_ions</a></span><span class="op">(</span><span class="va">data2</span>,</span>
<span>  ringwin <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  isowin <span class="op">=</span> <span class="fl">0.01</span>, trwin <span class="op">=</span> <span class="fl">0.005</span>,</span>
<span>  max_iso_shift <span class="op">=</span> <span class="fl">3</span>, merge_peaks <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  merge_method <span class="op">=</span> <span class="st">"sum"</span>,</span>
<span>  copy_object <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Checking 4956 peaks for mispicked peaks.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Argument merge_peaks is: TRUE. Merging mispicked peaks with method sum.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 270 ions failed the mispicked filter, 4686 ions remain.</span></span>
<span></span>
<span><span class="fu"><a href="../reference/get_peak_table.html">get_peak_table</a></span><span class="op">(</span><span class="va">data2_mispicked</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt; Key: &lt;Compound, mz, kmd, rt&gt;</span></span>
<span><span class="co">#&gt;               Compound        mz        kmd         rt</span></span>
<span><span class="co">#&gt;                 &lt;char&gt;     &lt;num&gt;      &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1: 0.03_102.1549m/z 102.15495 0.15494700 0.03431667</span></span>
<span><span class="co">#&gt;    2: 0.04_113.9641m/z 113.96412 0.96411580 0.04146667</span></span>
<span><span class="co">#&gt;    3: 0.06_182.9860m/z 182.98601 0.98600990 0.05573333</span></span>
<span><span class="co">#&gt;    4: 0.06_235.9635m/z 235.96353 0.96353360 0.05573333</span></span>
<span><span class="co">#&gt;    5:  0.09_68.9936m/z  68.99356 0.99355728 0.09145000</span></span>
<span><span class="co">#&gt;   ---                                                 </span></span>
<span><span class="co">#&gt; 4682: 9.99_463.1718m/z 463.17181 0.17180700 9.98643333</span></span>
<span><span class="co">#&gt; 4683: 9.99_480.7214m/z 480.72136 0.72135840 9.98643333</span></span>
<span><span class="co">#&gt; 4684:  9.99_87.5099m/z  87.50993 0.50992700 9.99358333</span></span>
<span><span class="co">#&gt; 4685:  9.99_92.9671m/z  92.96709 0.96708947 9.98643333</span></span>
<span><span class="co">#&gt; 4686:  9.99_95.0612m/z  95.06120 0.06119876 9.99358333</span></span>
<span><span class="co">#&gt;       200826_PTY087I2_0umce1_r1</span></span>
<span><span class="co">#&gt;                           &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:                   0.00000</span></span>
<span><span class="co">#&gt;    2:                 177.21710</span></span>
<span><span class="co">#&gt;    3:                5632.81768</span></span>
<span><span class="co">#&gt;    4:                  17.36759</span></span>
<span><span class="co">#&gt;    5:                  13.93727</span></span>
<span><span class="co">#&gt;   ---                          </span></span>
<span><span class="co">#&gt; 4682:                  85.71503</span></span>
<span><span class="co">#&gt; 4683:                   0.00000</span></span>
<span><span class="co">#&gt; 4684:                  26.94538</span></span>
<span><span class="co">#&gt; 4685:                  46.99969</span></span>
<span><span class="co">#&gt; 4686:                  31.83990</span></span></code></pre></div>
<p>This results in 4686 ions in the feature table (above). Even though
we created an object called <code>data2_mispicked</code>, the original
<code>data2</code> object was also updated and now has 4686 ions in the
feature table:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_peak_table.html">get_peak_table</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt; Key: &lt;Compound, mz, kmd, rt&gt;</span></span>
<span><span class="co">#&gt;               Compound        mz        kmd         rt</span></span>
<span><span class="co">#&gt;                 &lt;char&gt;     &lt;num&gt;      &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1: 0.03_102.1549m/z 102.15495 0.15494700 0.03431667</span></span>
<span><span class="co">#&gt;    2: 0.04_113.9641m/z 113.96412 0.96411580 0.04146667</span></span>
<span><span class="co">#&gt;    3: 0.06_182.9860m/z 182.98601 0.98600990 0.05573333</span></span>
<span><span class="co">#&gt;    4: 0.06_235.9635m/z 235.96353 0.96353360 0.05573333</span></span>
<span><span class="co">#&gt;    5:  0.09_68.9936m/z  68.99356 0.99355728 0.09145000</span></span>
<span><span class="co">#&gt;   ---                                                 </span></span>
<span><span class="co">#&gt; 4682: 9.99_463.1718m/z 463.17181 0.17180700 9.98643333</span></span>
<span><span class="co">#&gt; 4683: 9.99_480.7214m/z 480.72136 0.72135840 9.98643333</span></span>
<span><span class="co">#&gt; 4684:  9.99_87.5099m/z  87.50993 0.50992700 9.99358333</span></span>
<span><span class="co">#&gt; 4685:  9.99_92.9671m/z  92.96709 0.96708947 9.98643333</span></span>
<span><span class="co">#&gt; 4686:  9.99_95.0612m/z  95.06120 0.06119876 9.99358333</span></span>
<span><span class="co">#&gt;       200826_PTY087I2_0umce1_r1</span></span>
<span><span class="co">#&gt;                           &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:                   0.00000</span></span>
<span><span class="co">#&gt;    2:                 177.21710</span></span>
<span><span class="co">#&gt;    3:                5632.81768</span></span>
<span><span class="co">#&gt;    4:                  17.36759</span></span>
<span><span class="co">#&gt;    5:                  13.93727</span></span>
<span><span class="co">#&gt;   ---                          </span></span>
<span><span class="co">#&gt; 4682:                  85.71503</span></span>
<span><span class="co">#&gt; 4683:                   0.00000</span></span>
<span><span class="co">#&gt; 4684:                  26.94538</span></span>
<span><span class="co">#&gt; 4685:                  46.99969</span></span>
<span><span class="co">#&gt; 4686:                  31.83990</span></span></code></pre></div>
<p>We recommend using the default <code>copy_object = FALSE</code> as
this makes for an extremely fast and memory-efficient way to chain
mpactr filters together (see <strong>Chaining filters together</strong>
section and <a href="articles/reference_semantics.html">Reference
Semantics</a>); however, if you would like to run the filters
individually with traditional R style objects, you can set
<code>copy_object</code> to <code>TRUE</code> as shown in the filter
examples.</p>
</div>
<div class="section level2">
<h2 id="filtering">Filtering<a class="anchor" aria-label="anchor" href="#filtering"></a>
</h2>
<p>mpactr provides filters to correct for the following issues observed
during preprocessing of tandem MS/MS data:</p>
<ul>
<li>mispicked ions: isotopic patterns that are incorrectly split during
preprocessing.</li>
<li>solvent blank contamination: removal of features present in solvent
blanks due to carryover between samples.</li>
<li>background components: features whose abundance is greater than
user-defined abundance threshold in a specific group of samples, for
example media blanks.</li>
<li>non-reproducible ions: those that are inconsistent between technical
replicates.</li>
<li>insource ions: fragment ions created during ionization before
fragmentation in the tandem MS/MS workflow.</li>
</ul>
<div class="section level4">
<h4 id="mispicked-ions-filter">Mispicked ions filter<a class="anchor" aria-label="anchor" href="#mispicked-ions-filter"></a>
</h4>
<p>To check for mispicked ions, use mpactr function
<code><a href="../reference/filter_mispicked_ions.html">filter_mispicked_ions()</a></code>. This function takes an
<code>mpactr object</code> as input, and checks for similar ions with
the arguments <code>ringwin</code>, <code>isowin</code>,
<code>trwin</code> and <code>max_iso_shift</code>.</p>
<p>Ions in the feature table are flagged as similar based on retention
time and mass. Flagged ion groups are suggested to be the result of
incorrect splitting of isotopic patterns during peak picking, detector
saturation artifacts, or incorrect identification of multiply charged
oligomers.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_mispicked</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_mispicked_ions.html">filter_mispicked_ions</a></span><span class="op">(</span><span class="va">data</span>,</span>
<span>  ringwin <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  isowin <span class="op">=</span> <span class="fl">0.01</span>, trwin <span class="op">=</span> <span class="fl">0.005</span>,</span>
<span>  max_iso_shift <span class="op">=</span> <span class="fl">3</span>, merge_peaks <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  merge_method <span class="op">=</span> <span class="st">"sum"</span>,</span>
<span>  copy_object <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Checking 4956 peaks for mispicked peaks.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Argument merge_peaks is: TRUE. Merging mispicked peaks with method sum.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 270 ions failed the mispicked filter, 4686 ions remain.</span></span></code></pre></div>
<p>Each filter reports progress of filtering, here we can see that 4956
ions were present prior to checking for mispicked ions. 270 ions were
found to be similar to another ion and following merging, 4686 ions
remain.</p>
<p>If you are interested in the groups of similar ions flagged in this
filter, you can use <code><a href="../reference/get_similar_ions.html">get_similar_ions()</a></code>. This function
returns a <code>data.table</code> reporting the main ion (the ion
retained post-merging) and the ions similar to it.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_similar_ions.html">get_similar_ions</a></span><span class="op">(</span><span class="va">data_mispicked</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;            main_ion                      similar_ions</span></span>
<span><span class="co">#&gt;              &lt;char&gt;                            &lt;list&gt;</span></span>
<span><span class="co">#&gt; 1:  9.97_83.5172m/z                   9.97_84.9592m/z</span></span>
<span><span class="co">#&gt; 2:  9.97_91.0082m/z   9.97_91.5049m/z,9.97_93.5039m/z</span></span>
<span><span class="co">#&gt; 3:  1.99_91.0545m/z                   1.99_93.0679m/z</span></span>
<span><span class="co">#&gt; 4: 2.00_103.0545m/z                  2.00_105.0674m/z</span></span>
<span><span class="co">#&gt; 5: 9.99_106.0043m/z                  9.99_108.0234m/z</span></span>
<span><span class="co">#&gt; 6: 9.97_111.0207m/z 9.97_111.5219m/z,9.97_112.5194m/z</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="remove-ions-that-are-above-a-threshold-in-one-biological-group">Remove ions that are above a threshold in one biological group<a class="anchor" aria-label="anchor" href="#remove-ions-that-are-above-a-threshold-in-one-biological-group"></a>
</h4>
<p>Removing solvent blank impurities is important for correcting for
between-sample carryover and contamination in experimental samples. You
can identify and remove these ions with mpactr’s
<code><a href="../reference/filter_group.html">filter_group()</a></code> function. <code><a href="../reference/filter_group.html">filter_group()</a></code>
identifies ions above a relative abundance threshold
(<code>group_threshold</code>) in a specific group
(<code>group_to_remove</code>). To remove solvent blank impurities, set
<code>group_to_remove</code> to the <code>Biological_Group</code> in
your metadata file which corresponds to your solvent blank samples, here
“Blanks”.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_blank</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_group.html">filter_group</a></span><span class="op">(</span><span class="va">data</span>,</span>
<span>  group_threshold <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  group_to_remove <span class="op">=</span> <span class="st">"Blanks"</span>, remove_ions <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  copy_object <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Parsing 4956 peaks based on the sample group: Blanks.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Argument remove_ions is: TRUE.Removing peaks from Blanks.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 1822 ions failed the Blanks filter, 3134 ions remain.</span></span></code></pre></div>
<p>In this example, 4956 ions were present prior to the group filter.
1822 ions were found to be above the relative abundance threshold of
0.01 in “Solvent_Blank” samples, leaving 3134 ions in the peak
table.</p>
<p>We can also use this filter to remove ions from other groups, such as
media blanks. This can be useful for experiments on cell cultures. The
example data contains samples belonging to the
<code>Biological_Group</code> “Media”. These samples are from media
blanks, which are negative controls from the growth experiments
conducted in this study. We can remove features whose abundance is
greater than 1% of the largest group in media blank samples by
specifying <code>group_to_remove</code> = “Media”. We recommend removing
media blank ions following all other filters so all high-quality ions
are identified (see Chaining filters together below).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_media_blank</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_group.html">filter_group</a></span><span class="op">(</span><span class="va">data</span>,</span>
<span>  group_threshold <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  group_to_remove <span class="op">=</span> <span class="st">"Media"</span>, remove_ions <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  copy_object <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Parsing 4956 peaks based on the sample group: Media.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Argument remove_ions is: TRUE.Removing peaks from Media.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 3936 ions failed the Media filter, 1020 ions remain.</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="remove-non-reproducible-ions">Remove non-reproducible ions<a class="anchor" aria-label="anchor" href="#remove-non-reproducible-ions"></a>
</h4>
<p>Ions whose abundance are not consisent between technical replicates
(<em>i.e.</em>, non-reproducible) may not be reliable for analysis and
therefore should be removed from the feature table. Non-reproducible
ions are identified by mean or median coefficient of variation (CV)
between technical replicates with <code><a href="../reference/filter_cv.html">filter_cv()</a></code>. Note - this
filter cannot be applied to data that does not contain technical
replicates.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_rep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_cv.html">filter_cv</a></span><span class="op">(</span><span class="va">data</span>,</span>
<span>  cv_threshold <span class="op">=</span> <span class="fl">0.2</span>, cv_param <span class="op">=</span> <span class="st">"median"</span>,</span>
<span>  copy_object <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Parsing 4956 peaks for replicability across technical replicates.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 2179 ions failed the cv_filter filter, 2777 ions remain.</span></span></code></pre></div>
<p>In our example dataset, 2179 ions were flagged as non-reproducible.
These ions were removed, leaving 2777 ions in the feature table.</p>
<p>If you would like to visualize how the CV threshold performed on your
dataset, you can extract the CV calculated during
<code>filer_cv()</code> using mpactr’s <code><a href="../reference/get_cv_data.html">get_cv_data()</a></code>
function, and calculate the percentage of features for plotting. You can
look at both mean and median CV as shown in the example below, or you
can filter the data by the parameter of choice.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_cv_data.html">get_cv_data</a></span><span class="op">(</span><span class="va">data_rep</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean_cv"</span>, <span class="st">"median_cv"</span><span class="op">)</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"param"</span>,</span>
<span>               values_to <span class="op">=</span> <span class="st">"cv"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="va">param</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">arrange</span>, <span class="va">cv</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">mutate</span>, index <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cv</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">mutate</span>, index_scale <span class="op">=</span> <span class="va">index</span> <span class="op">*</span> <span class="fl">100</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cv</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cv</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">#&gt;   param     data                </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> mean_cv   <span style="color: #949494;">&lt;tibble [4,956 × 4]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> median_cv <span style="color: #949494;">&lt;tibble [4,956 × 4]&gt;</span></span></span></code></pre></div>
<p>The nested data are tibbles with the columns Compound, cv, index,
index_scale:</p>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;   Compound               cv index index_scale</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 0.81_210.0803m/z  0.006<span style="text-decoration: underline;">36</span>     0      0     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 10.02_89.5072m/z  0.006<span style="text-decoration: underline;">86</span>     1      0.020<span style="text-decoration: underline;">2</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 10.02_110.0204m/z 0.008<span style="text-decoration: underline;">31</span>     2      0.040<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 0.72_203.9632n    0.009<span style="text-decoration: underline;">28</span>     3      0.060<span style="text-decoration: underline;">5</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 0.80_418.1451n    0.010<span style="text-decoration: underline;">0</span>      4      0.080<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 1.96_293.6773m/z  0.010<span style="text-decoration: underline;">4</span>      5      0.101</span></span></code></pre>
<p>There is one tibble for each parameter (either mean or median). We
also want to calculate the percentage of features represented by the CV
threshold.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cv_thresh_percent</span> <span class="op">&lt;-</span> <span class="va">cv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">param</span> <span class="op">==</span> <span class="st">"median_cv"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="va">data</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>diff_cv_thresh <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">cv</span> <span class="op">-</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_min</a></span><span class="op">(</span><span class="va">diff_cv_thresh</span>, n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">index_scale</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cv_thresh_percent</span></span>
<span><span class="co">#&gt; [1] 56.03309</span></span></code></pre></div>
<p>Then we can plot percentage of features by CV:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="va">data</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">param</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean_cv"</span>, <span class="st">"median_cv"</span><span class="op">)</span>,</span>
<span>                        labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"median"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">cv</span>, y <span class="op">=</span> <span class="va">index_scale</span>, group <span class="op">=</span> <span class="va">param</span>, color <span class="op">=</span> <span class="va">param</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"darkgrey"</span>,</span>
<span>             linetype <span class="op">=</span> <span class="st">"dashed"</span>,</span>
<span>             linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">cv_thresh_percent</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"darkgrey"</span>,</span>
<span>             linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"CV"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Percentage of Features"</span>,</span>
<span>       param <span class="op">=</span> <span class="st">"Statistic"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,</span>
<span>    axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"inside"</span>,</span>
<span>    legend.position.inside <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.90</span>, <span class="fl">.08</span><span class="op">)</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="filter2_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<p>Here we can see that roughly 56% of features were below the CV
threshold meaning 44% were removed at a CV threshold of 0.2.</p>
</div>
<div class="section level4">
<h4 id="remove-insource-fragment-ions">Remove insource fragment ions<a class="anchor" aria-label="anchor" href="#remove-insource-fragment-ions"></a>
</h4>
<p>Some mass species can be fragmented during ionization in tandem
MS/MS, creating insource ions. This can result in ions from one compound
being represented more than once in the feature table. If you would like
to remove insource ions fragments, you can do so with mpactr’s
<code><a href="../reference/filter_insource_ions.html">filter_insource_ions()</a></code>. <code><a href="../reference/filter_insource_ions.html">filter_insource_ions()</a></code>
conducts ion deconvolution via retention time correlation matrices
within MS1 scans. Highly correlated ion groups are determined by the
<code>cluster_threshold</code> parameter and filtered to remove the low
mass features. The highest mass feature is identified as the likely
precursor ion and retained in the feature table.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_insource</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_insource_ions.html">filter_insource_ions</a></span><span class="op">(</span><span class="va">data</span>,</span>
<span>  cluster_threshold <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  copy_object <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Parsing 4956 peaks for insource ions.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 600 ions failed the insource filter, 4356 ions remain.</span></span></code></pre></div>
<p>600 ions were identified and removed during deconvolution of this
dataset, leaving 4356 ions in the feature table.</p>
</div>
<div class="section level4">
<h4 id="chaining-filters-together">Chaining filters together<a class="anchor" aria-label="anchor" href="#chaining-filters-together"></a>
</h4>
<p>Filters can be chained in a customizable workflow, shown below. While
filters can be chained in any order, we recommend filtering mispicked
ions, then solvent blanks, prior to filtering non-repoducible or
insource ions. This will allow for incorrectly picked peaks to be merged
and any contamination/carryover removed prior to identifying
non-reproducible and insource fragment ions. Here we also demonstrate
the removal of media blank components with the
<code><a href="../reference/filter_group.html">filter_group()</a></code> function after identification of
high-quality ions.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_data.html">import_data</a></span><span class="op">(</span>peak_table <span class="op">=</span> <span class="st">"https://raw.githubusercontent.com/BalunasLab/mpact/main/rawdata/PTY087I2/200826_PTY087I2codingdataset.csv"</span>,</span>
<span>  meta_data <span class="op">=</span> <span class="va">meta_data</span>,</span>
<span>  format <span class="op">=</span> <span class="st">"Progenesis"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_filtered</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_mispicked_ions.html">filter_mispicked_ions</a></span><span class="op">(</span><span class="va">data</span>, merge_method <span class="op">=</span> <span class="st">"sum"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/filter_group.html">filter_group</a></span><span class="op">(</span>group_to_remove <span class="op">=</span> <span class="st">"Blanks"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/filter_cv.html">filter_cv</a></span><span class="op">(</span>cv_threshold <span class="op">=</span> <span class="fl">0.2</span>, cv_param <span class="op">=</span> <span class="st">"median"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/filter_group.html">filter_group</a></span><span class="op">(</span>group_to_remove <span class="op">=</span> <span class="st">"Media"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Checking 4956 peaks for mispicked peaks.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Argument merge_peaks is: TRUE. Merging mispicked peaks with method sum.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 270 ions failed the mispicked filter, 4686 ions remain.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Parsing 4686 peaks based on the sample group: Blanks.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Argument remove_ions is: TRUE.Removing peaks from Blanks.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 1741 ions failed the Blanks filter, 2945 ions remain.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Parsing 2945 peaks for replicability across technical replicates.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 1143 ions failed the cv_filter filter, 1802 ions remain.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Parsing 1802 peaks based on the sample group: Media.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Argument remove_ions is: TRUE.Removing peaks from Media.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 1239 ions failed the Media filter, 563 ions remain.</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>mpactr offers mutliple ways to view a summary of data filtering.</p>
<div class="section level4">
<h4 id="view-passing-and-failed-ions-for-a-single-filter">View passing and failed ions for a single filter<a class="anchor" aria-label="anchor" href="#view-passing-and-failed-ions-for-a-single-filter"></a>
</h4>
<p>If you are interested in viewing the passing and failing ions for a
single filter, use the <code><a href="../reference/filter_summary.html">filter_summary()</a></code> function. You must
specify which filter you are intested in, either “mispicked”, “group”,
“replicability”, or “insource”.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mispicked_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_summary.html">filter_summary</a></span><span class="op">(</span><span class="va">data_filtered</span>, filter <span class="op">=</span> <span class="st">"mispicked"</span><span class="op">)</span></span></code></pre></div>
<p>Failed ions:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mispicked_summary</span><span class="op">$</span><span class="va">failed_ions</span>, <span class="fl">100</span><span class="op">)</span></span>
<span><span class="co">#&gt;   [1] "9.97_84.9592m/z"   "9.97_91.5049m/z"   "9.97_93.5039m/z"  </span></span>
<span><span class="co">#&gt;   [4] "1.99_93.0679m/z"   "2.00_105.0674m/z"  "9.99_108.0234m/z" </span></span>
<span><span class="co">#&gt;   [7] "9.97_111.5219m/z"  "9.97_112.5194m/z"  "2.32_117.0586m/z" </span></span>
<span><span class="co">#&gt;  [10] "2.00_120.0817m/z"  "2.00_120.1345m/z"  "2.00_120.1704m/z" </span></span>
<span><span class="co">#&gt;  [13] "0.77_118.1157m/z"  "1.99_120.3792m/z"  "2.32_132.0815m/z" </span></span>
<span><span class="co">#&gt;  [16] "0.67_131.5785m/z"  "1.46_132.1331m/z"  "1.21_133.0896n"   </span></span>
<span><span class="co">#&gt;  [19] "0.84_139.0507m/z"  "2.32_143.0736m/z"  "2.32_144.0816m/z" </span></span>
<span><span class="co">#&gt;  [22] "0.62_143.5978m/z"  "0.67_147.1134m/z"  "3.92_151.0634m/z" </span></span>
<span><span class="co">#&gt;  [25] "4.62_165.0704m/z"  "2.00_166.4370m/z"  "1.99_166.1491m/z" </span></span>
<span><span class="co">#&gt;  [28] "4.12_176.0628m/z"  "0.62_180.6223m/z"  "10.11_183.0220m/z"</span></span>
<span><span class="co">#&gt;  [31] "0.94_186.5569m/z"  "1.21_189.1242m/z"  "0.94_190.0465m/z" </span></span>
<span><span class="co">#&gt;  [34] "3.61_193.0423m/z"  "0.62_195.6240m/z"  "1.19_196.0381n"   </span></span>
<span><span class="co">#&gt;  [37] "4.78_198.0854m/z"  "1.21_201.0726m/z"  "1.21_202.1205m/z" </span></span>
<span><span class="co">#&gt;  [40] "2.07_202.1180m/z"  "3.63_207.0634m/z"  "0.81_210.1507m/z" </span></span>
<span><span class="co">#&gt;  [43] "0.81_210.1997m/z"  "0.81_210.2631m/z"  "0.81_210.4740m/z" </span></span>
<span><span class="co">#&gt;  [46] "2.94_212.1208m/z"  "0.65_213.0191m/z"  "2.07_217.1056m/z" </span></span>
<span><span class="co">#&gt;  [49] "1.91_217.1553m/z"  "1.20_218.1109m/z"  "1.22_221.5316m/z" </span></span>
<span><span class="co">#&gt;  [52] "1.21_223.0594m/z"  "1.96_227.6359m/z"  "1.21_227.1005m/z" </span></span>
<span><span class="co">#&gt;  [55] "0.84_226.1553m/z"  "3.72_227.1760m/z"  "3.63_229.0865m/z" </span></span>
<span><span class="co">#&gt;  [58] "1.21_231.1367m/z"  "1.92_234.1403m/z"  "1.22_237.1363m/z" </span></span>
<span><span class="co">#&gt;  [61] "0.63_238.1461m/z"  "2.35_237.1243m/z"  "1.21_244.1664m/z" </span></span>
<span><span class="co">#&gt;  [64] "0.66_244.1380m/z"  "1.21_247.1298m/z"  "0.67_123.5768n"   </span></span>
<span><span class="co">#&gt;  [67] "2.22_247.1295m/z"  "4.12_250.5607m/z"  "0.62_250.1370m/z" </span></span>
<span><span class="co">#&gt;  [70] "0.62_252.1540m/z"  "2.23_250.1917m/z"  "1.82_252.1519m/z" </span></span>
<span><span class="co">#&gt;  [73] "0.83_253.1626n"    "0.75_258.1110m/z"  "3.14_258.5443m/z" </span></span>
<span><span class="co">#&gt;  [76] "0.66_257.6233m/z"  "0.66_258.1473m/z"  "0.75_261.0120m/z" </span></span>
<span><span class="co">#&gt;  [79] "1.24_260.1969m/z"  "3.96_263.5542m/z"  "1.17_265.0928m/z" </span></span>
<span><span class="co">#&gt;  [82] "0.64_271.9292m/z"  "9.97_250.9284n"    "1.21_273.1650m/z" </span></span>
<span><span class="co">#&gt;  [85] "1.21_274.0933m/z"  "2.35_275.6568m/z"  "1.17_275.6450m/z" </span></span>
<span><span class="co">#&gt;  [88] "3.43_278.0424m/z"  "0.64_280.6631m/z"  "1.89_283.6481m/z" </span></span>
<span><span class="co">#&gt;  [91] "3.99_286.0659m/z"  "0.64_288.1607m/z"  "1.21_287.5791m/z" </span></span>
<span><span class="co">#&gt;  [94] "1.17_143.5989n"    "0.83_288.2030m/z"  "1.20_289.6186m/z" </span></span>
<span><span class="co">#&gt;  [97] "0.83_291.1546m/z"  "0.64_292.4432m/z"  "10.09_294.0010m/z"</span></span>
<span><span class="co">#&gt; [100] "1.21_294.5725m/z"</span></span></code></pre></div>
<p>Passing ions:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mispicked_summary</span><span class="op">$</span><span class="va">passed_ions</span>, <span class="fl">100</span><span class="op">)</span></span>
<span><span class="co">#&gt;   [1] "0.03_102.1549m/z" "0.04_113.9641m/z" "0.06_182.9860m/z"</span></span>
<span><span class="co">#&gt;   [4] "0.06_235.9635m/z" "0.09_68.9936m/z"  "0.10_102.1549m/z"</span></span>
<span><span class="co">#&gt;   [7] "0.13_102.1552m/z" "0.17_213.0188m/z" "0.23_102.1549m/z"</span></span>
<span><span class="co">#&gt;  [10] "0.28_691.4629m/z" "0.33_102.1550m/z" "0.35_68.9936m/z" </span></span>
<span><span class="co">#&gt;  [13] "0.39_102.1549m/z" "0.40_213.0184m/z" "0.41_145.0360m/z"</span></span>
<span><span class="co">#&gt;  [16] "0.43_102.1549m/z" "0.45_345.2033m/z" "0.48_102.1548m/z"</span></span>
<span><span class="co">#&gt;  [19] "0.53_102.1550m/z" "0.57_153.7767m/z" "0.57_201.7990m/z"</span></span>
<span><span class="co">#&gt;  [22] "0.58_177.4624m/z" "0.59_144.4417m/z" "0.59_203.2244m/z"</span></span>
<span><span class="co">#&gt;  [25] "0.59_250.8096m/z" "0.60_129.1388m/z" "0.60_146.1659m/z"</span></span>
<span><span class="co">#&gt;  [28] "0.60_182.7792m/z" "0.60_220.1359m/z" "0.60_308.2184m/z"</span></span>
<span><span class="co">#&gt;  [31] "0.60_397.4459m/z" "0.61_138.1082m/z" "0.61_173.6264m/z"</span></span>
<span><span class="co">#&gt;  [34] "0.61_188.6307m/z" "0.61_195.1269m/z" "0.61_209.1333m/z"</span></span>
<span><span class="co">#&gt;  [37] "0.61_210.1284m/z" "0.61_300.1594m/z" "0.62_129.5943m/z"</span></span>
<span><span class="co">#&gt;  [40] "0.62_141.5828n"   "0.62_143.0402m/z" "0.62_152.1111m/z"</span></span>
<span><span class="co">#&gt;  [43] "0.62_178.1125m/z" "0.62_186.1072m/z" "0.62_187.6351m/z"</span></span>
<span><span class="co">#&gt;  [46] "0.62_193.1150m/z" "0.62_202.6318m/z" "0.62_206.6184m/z"</span></span>
<span><span class="co">#&gt;  [49] "0.62_207.1142m/z" "0.62_216.1416m/z" "0.62_216.6342m/z"</span></span>
<span><span class="co">#&gt;  [52] "0.62_223.1375m/z" "0.62_224.1328m/z" "0.62_230.1451m/z"</span></span>
<span><span class="co">#&gt;  [55] "0.62_237.6514m/z" "0.62_242.6282m/z" "0.62_247.8076m/z"</span></span>
<span><span class="co">#&gt;  [58] "0.62_249.6332m/z" "0.62_252.6512m/z" "0.62_259.1503m/z"</span></span>
<span><span class="co">#&gt;  [61] "0.62_267.1498m/z" "0.62_273.6578m/z" "0.62_281.1568m/z"</span></span>
<span><span class="co">#&gt;  [64] "0.62_295.1650m/z" "0.62_312.1757m/z" "0.63_102.1551m/z"</span></span>
<span><span class="co">#&gt;  [67] "0.63_119.4797m/z" "0.63_133.4769m/z" "0.63_153.9915m/z"</span></span>
<span><span class="co">#&gt;  [70] "0.63_156.5933m/z" "0.63_166.1144m/z" "0.63_174.5051m/z"</span></span>
<span><span class="co">#&gt;  [73] "0.63_192.1185m/z" "0.63_200.6172m/z" "0.63_214.9373m/z"</span></span>
<span><span class="co">#&gt;  [76] "0.63_221.1212m/z" "0.63_228.6148m/z" "0.63_235.6279m/z"</span></span>
<span><span class="co">#&gt;  [79] "0.63_245.1423m/z" "0.63_265.4417m/z" "0.63_268.1517m/z"</span></span>
<span><span class="co">#&gt;  [82] "0.63_269.1494m/z" "0.63_270.1403n"   "0.63_280.1518m/z"</span></span>
<span><span class="co">#&gt;  [85] "0.63_283.9593m/z" "0.63_311.9542m/z" "0.64_102.0344m/z"</span></span>
<span><span class="co">#&gt;  [88] "0.64_110.9997n"   "0.64_151.0360m/z" "0.64_161.5051m/z"</span></span>
<span><span class="co">#&gt;  [91] "0.64_177.7884m/z" "0.64_185.4569m/z" "0.64_190.4682m/z"</span></span>
<span><span class="co">#&gt;  [94] "0.64_198.4570m/z" "0.64_200.1062m/z" "0.64_201.6398m/z"</span></span>
<span><span class="co">#&gt;  [97] "0.64_209.6270m/z" "0.64_257.9271m/z" "0.64_259.6555m/z"</span></span>
<span><span class="co">#&gt; [100] "0.64_270.9272m/z"</span></span></code></pre></div>
<p>If you set <code>filter</code> to a filter name that you did not
apply to your data, an error message will be returned.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/filter_summary.html">filter_summary</a></span><span class="op">(</span><span class="va">data_filtered</span>, filter <span class="op">=</span> <span class="st">"insource"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `mpactr_object$get_log()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> `filter` insource has not yet been applied to the data. Run the</span></span>
<span><span class="co">#&gt;   corresponding filter function prior to extracting the summary.</span></span></code></pre></div>
<p>If you want to retrieve the filter summary for the group filter, you
must also supply the group name with the <code>group</code>
argument:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/filter_summary.html">filter_summary</a></span><span class="op">(</span><span class="va">data_filtered</span>, filter <span class="op">=</span> <span class="st">"group"</span>, group <span class="op">=</span> <span class="st">"Blanks"</span><span class="op">)</span></span></code></pre></div>
<p><code>group</code> must always be supplied for this filter, even if
only one group filter has been applied.</p>
</div>
<div class="section level4">
<h4 id="view-passing-and-failed-ions-for-all-input-ions">View passing and failed ions for all input ions<a class="anchor" aria-label="anchor" href="#view-passing-and-failed-ions-for-all-input-ions"></a>
</h4>
<p>You can view the filtering status of all input ions with the
<code><a href="../reference/qc_summary.html">qc_summary()</a></code> function. A data.table reporting the compound
id (<code>compounds</code>) and if it failed or passed filtering. If the
ion failed filtering, its status will report the name of the filter it
failed.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/qc_summary.html">qc_summary</a></span><span class="op">(</span><span class="va">data_filtered</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">compounds</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;           status        compounds</span></span>
<span><span class="co">#&gt;           &lt;char&gt;           &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:  group-Blanks 0.03_102.1549m/z</span></span>
<span><span class="co">#&gt; 2:  group-Blanks 0.04_113.9641m/z</span></span>
<span><span class="co">#&gt; 3:  group-Blanks 0.06_182.9860m/z</span></span>
<span><span class="co">#&gt; 4:  group-Blanks 0.06_235.9635m/z</span></span>
<span><span class="co">#&gt; 5: replicability  0.09_68.9936m/z</span></span>
<span><span class="co">#&gt; 6:  group-Blanks 0.10_102.1549m/z</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="visualize-filtering-qc-with-tree-map-plot">Visualize filtering QC with tree map plot<a class="anchor" aria-label="anchor" href="#visualize-filtering-qc-with-tree-map-plot"></a>
</h4>
<p>You can visualize filtering results with a tree map using the
filtering summary obtained from <code><a href="../reference/qc_summary.html">qc_summary()</a></code> and the
packages <code>ggplot2</code> and <code>treemapify</code>.</p>
<p>First, we need to determine the number of ions for each ion status in
the summary table. You can report the count; however, we need to
calculate the percent of ions in each group. We have done this in the
code chunk below, where we have used <code>data.table</code> syntax as
the <code><a href="../reference/qc_summary.html">qc_summary()</a></code> returns a <code>data.table</code> object.
If you are not familiar with the package data.table, check out their
resources on <a href="https://rdatatable.gitlab.io/data.table/" class="external-link">gitlab</a>.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkox.org/treemapify/" class="external-link">treemapify</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ion_counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/qc_summary.html">qc_summary</a></span><span class="op">(</span><span class="va">data_filtered</span><span class="op">)</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>count <span class="op">=</span> <span class="va">.N</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">status</span><span class="op">]</span><span class="op">[</span></span>
<span>  , <span class="va">percent</span> <span class="op">:=</span> <span class="op">(</span><span class="va">count</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="op">]</span></span></code></pre></div>
<p>Finally, we plot the treemap:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ion_counts</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>area <span class="op">=</span> <span class="va">percent</span>, fill <span class="op">=</span> <span class="va">status</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://wilkox.org/treemapify/reference/geom_treemap.html" class="external-link">geom_treemap</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://wilkox.org/treemapify/reference/geom_treemap_text.html" class="external-link">geom_treemap_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">status</span>, <span class="va">count</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">percent</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"%)"</span><span class="op">)</span>,</span>
<span>                  sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span>,</span>
<span>    fontface <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bold"</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tm</span></span></code></pre></div>
<p><img src="filter2_files/figure-html/unnamed-chunk-31-1.png" width="700"></p>
<p>This plot can be customized with ggplot2, for example we only want to
display the percentage:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ion_counts</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>area <span class="op">=</span> <span class="va">percent</span>, fill <span class="op">=</span> <span class="va">status</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://wilkox.org/treemapify/reference/geom_treemap.html" class="external-link">geom_treemap</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://wilkox.org/treemapify/reference/geom_treemap_text.html" class="external-link">geom_treemap_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">status</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">percent</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"%)"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span>,</span>
<span>    fontface <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bold"</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tm</span></span></code></pre></div>
<p><img src="filter2_files/figure-html/unnamed-chunk-32-1.png" width="700"></p>
<p>Or you no longer need the legend and maybe we want custom colors:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tm</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Greens"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<p><img src="filter2_files/figure-html/unnamed-chunk-33-1.png" width="700"></p>
<p>If you want a fast visualization of the treemap, you can pass the
mpactr object to the function <code><a href="../reference/plot_qc_tree.html">plot_qc_tree()</a></code>.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_qc_tree.html">plot_qc_tree</a></span><span class="op">(</span><span class="va">data_filtered</span><span class="op">)</span></span></code></pre></div>
<p><img src="filter2_files/figure-html/unnamed-chunk-34-1.png" width="700"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Allison Mason, Gregory Johnson, Patrick Schloss.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
