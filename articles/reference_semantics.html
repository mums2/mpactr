<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Reference Semantics • mpactr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Reference Semantics">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mpactr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/reference_semantics.html">Reference Semantics</a></li>
    <li><a class="dropdown-item" href="../articles/filter2.html">Filter</a></li>
    <li><a class="dropdown-item" href="../articles/downstream_analyses.html">Additional Analyses</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mums2/mpactr"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Reference Semantics</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mums2/mpactr/blob/main/vignettes/articles/reference_semantics.Rmd" class="external-link"><code>vignettes/articles/reference_semantics.Rmd</code></a></small>
      <div class="d-none name"><code>reference_semantics.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mums2.github.io/mpactr/">mpactr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: data.table</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'mpactr'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:utils':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     example</span></span></code></pre></div>
<div class="section level2">
<h2 id="reference-semantics">Reference semantics<a class="anchor" aria-label="anchor" href="#reference-semantics"></a>
</h2>
<p>mpactr is built on an R6 class-system, meaning it operates on
reference semantics in which data is updated <em>in-place</em>. Compared
to a shallow copy, where only data pointers are copied, or a deep copy,
where the entire data object is copied in memory, any changes to the
original data object, regardless if they are assigned to a new object,
result in changes to the original data object. We can see this
below.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_data.html">import_data</a></span><span class="op">(</span><span class="fu"><a href="../reference/example.html">example</a></span><span class="op">(</span><span class="st">"cultures_peak_table.csv"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/example.html">example</a></span><span class="op">(</span><span class="st">"cultures_metadata.csv"</span><span class="op">)</span>,</span>
<span>  format <span class="op">=</span> <span class="st">"Progenesis"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="../reference/get_peak_table.html">get_peak_table</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt;       Compound       mz         rt 102623_UM1848B_JC1_69_1_5004</span></span>
<span><span class="co">#&gt;         &lt;char&gt;    &lt;num&gt;      &lt;num&gt;                        &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:        1 256.0883  0.7748333                         0.00</span></span>
<span><span class="co">#&gt;    2:        2 484.2921  0.7756667                       546.56</span></span>
<span><span class="co">#&gt;    3:        3 445.2276  0.7786667                         0.00</span></span>
<span><span class="co">#&gt;    4:        4 354.1842  0.7786667                         0.00</span></span>
<span><span class="co">#&gt;    5:        5 353.1995  0.7816667                         0.00</span></span>
<span><span class="co">#&gt;   ---                                                          </span></span>
<span><span class="co">#&gt; 1330:     1330 538.3182 11.4396667                         0.00</span></span>
<span><span class="co">#&gt; 1331:     1331 424.2710 11.4315000                         0.00</span></span>
<span><span class="co">#&gt; 1332:     1332 422.1770 11.4568333                     10655.27</span></span>
<span><span class="co">#&gt; 1333:     1333 422.1776 11.4528333                       923.77</span></span>
<span><span class="co">#&gt; 1334:     1334 538.3981 11.4811667                      1176.19</span></span>
<span><span class="co">#&gt;       102623_UM1846B_Media_67_1_5005</span></span>
<span><span class="co">#&gt;                                &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:                           0.00</span></span>
<span><span class="co">#&gt;    2:                       16389.28</span></span>
<span><span class="co">#&gt;    3:                       22515.28</span></span>
<span><span class="co">#&gt;    4:                        6086.35</span></span>
<span><span class="co">#&gt;    5:                        5923.96</span></span>
<span><span class="co">#&gt;   ---                               </span></span>
<span><span class="co">#&gt; 1330:                           0.00</span></span>
<span><span class="co">#&gt; 1331:                           0.00</span></span>
<span><span class="co">#&gt; 1332:                        5737.01</span></span>
<span><span class="co">#&gt; 1333:                           0.00</span></span>
<span><span class="co">#&gt; 1334:                        1353.96</span></span></code></pre></div>
<p>Where the raw data object has 1334 ions in the feature table.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data2_mispicked</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_mispicked_ions.html">filter_mispicked_ions</a></span><span class="op">(</span><span class="va">data2</span>,</span>
<span>  ringwin <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  isowin <span class="op">=</span> <span class="fl">0.01</span>, trwin <span class="op">=</span> <span class="fl">0.005</span>,</span>
<span>  max_iso_shift <span class="op">=</span> <span class="fl">3</span>, merge_peaks <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  merge_method <span class="op">=</span> <span class="st">"sum"</span>,</span>
<span>  copy_object <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Checking 1334 peaks for mispicked peaks.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Argument merge_peaks is: TRUE. Merging mispicked peaks with method sum.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 73 ions failed the mispicked filter, 1261 ions remain.</span></span>
<span></span>
<span><span class="fu"><a href="../reference/get_peak_table.html">get_peak_table</a></span><span class="op">(</span><span class="va">data2_mispicked</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt; Key: &lt;Compound, mz, kmd, rt&gt;</span></span>
<span><span class="co">#&gt;       Compound       mz     kmd        rt 102423_Blank_77_1_5095</span></span>
<span><span class="co">#&gt;         &lt;char&gt;    &lt;num&gt;   &lt;num&gt;     &lt;num&gt;                  &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:        1 256.0883 0.08831 0.7748333                      0</span></span>
<span><span class="co">#&gt;    2:       10 340.2040 0.20399 0.7916667                      0</span></span>
<span><span class="co">#&gt;    3:      100 557.1519 0.15191 3.6925000                      0</span></span>
<span><span class="co">#&gt;    4:     1000 278.0638 0.06382 5.5228333                      0</span></span>
<span><span class="co">#&gt;    5:     1001 296.0736 0.07365 5.5246667                      0</span></span>
<span><span class="co">#&gt;   ---                                                           </span></span>
<span><span class="co">#&gt; 1257:      995 561.2726 0.27255 5.4810000                      0</span></span>
<span><span class="co">#&gt; 1258:      996 228.1430 0.14305 5.4818333                      0</span></span>
<span><span class="co">#&gt; 1259:      997 425.1873 0.18726 5.4640000                      0</span></span>
<span><span class="co">#&gt; 1260:      998 337.1987 0.19873 5.4818333                      0</span></span>
<span><span class="co">#&gt; 1261:      999 640.3299 0.32993 5.4596667                      0</span></span></code></pre></div>
<p>Running the <code>filter_mispicked_ions</code> filter, with default
setting <code>copy_object = FALSE</code> (operates on reference
semantics) results in 1261 ions in the feature table.</p>
<p>Even though we created an object called <code>data2_mispicked</code>,
the original <code>data2</code> object was also updated and now has 1261
ions in the feature table:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_peak_table.html">get_peak_table</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt; Key: &lt;Compound, mz, kmd, rt&gt;</span></span>
<span><span class="co">#&gt;       Compound       mz     kmd        rt 102423_Blank_77_1_5095</span></span>
<span><span class="co">#&gt;         &lt;char&gt;    &lt;num&gt;   &lt;num&gt;     &lt;num&gt;                  &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:        1 256.0883 0.08831 0.7748333                      0</span></span>
<span><span class="co">#&gt;    2:       10 340.2040 0.20399 0.7916667                      0</span></span>
<span><span class="co">#&gt;    3:      100 557.1519 0.15191 3.6925000                      0</span></span>
<span><span class="co">#&gt;    4:     1000 278.0638 0.06382 5.5228333                      0</span></span>
<span><span class="co">#&gt;    5:     1001 296.0736 0.07365 5.5246667                      0</span></span>
<span><span class="co">#&gt;   ---                                                           </span></span>
<span><span class="co">#&gt; 1257:      995 561.2726 0.27255 5.4810000                      0</span></span>
<span><span class="co">#&gt; 1258:      996 228.1430 0.14305 5.4818333                      0</span></span>
<span><span class="co">#&gt; 1259:      997 425.1873 0.18726 5.4640000                      0</span></span>
<span><span class="co">#&gt; 1260:      998 337.1987 0.19873 5.4818333                      0</span></span>
<span><span class="co">#&gt; 1261:      999 640.3299 0.32993 5.4596667                      0</span></span></code></pre></div>
<p>We recommend using the default <code>copy_object = FALSE</code> as
this makes for an extremely fast and memory-efficient way to chain
mpactr filters together (see the Filter article); however, if you would
like to run the filters individually with traditional R style objects,
you can set <code>copy_object</code> to <code>TRUE</code> as shown in
the filter examples.</p>
</div>
<div class="section level2">
<h2 id="deep-copy-specifics-of-the-r6-class">Deep copy: specifics of the R6 class<a class="anchor" aria-label="anchor" href="#deep-copy-specifics-of-the-r6-class"></a>
</h2>
<p>The R6 class-system operates on reference semantics in which data is
updated <em>in-place</em>. Compared to a shallow copy, where only data
pointers are copied, or a deep copy, where the entire data object is
copied in memory, any changes to the original data object, regardless if
they are assigned to a new object, result in changes to the original
data object. R6 Accomplishes this by taking advantaging of the
environment system in R. Inside R, everything is created inside a base R
environment. This contains all functions, saved variables, libraries,
references, etc. Using R6 classes allows us to easily add this
functionality to our R package.</p>
<p>In general, R relies on reference semantics to store data away from
the outside because R environments are a container for a copious amount
of data. In a normal R session, the base R environment is the outermost
environment, allowing you to access to everything you need.</p>
<p>Reference semantics become noticeable when you send an environmental
variable to a function. In R, functions rely on call-by-value semantics.
Call-by-value is described as functions treating parameterized values
(values specified when calling the function) as local variables when in
the function. Anything you do to the variable in the function will have
no effect on the variables outside. This follows traditional copy by
value semantics. However, R does not allow you to send over variables by
reference due to this idea. So, you can think of functions as temporary
environments in R. What makes these environments so powerful, is the
fact that you can send an environment to a function, and it will not
copy the environment. This allows you to send variables by reference to
functions. R6 classes rely on this, and mpactr uses this for speedy
execution.</p>
<p>Memory usage really shines when you use R6 classes vs. a traditional
workflow, such as copy by value. In a traditional workflow, all of the
data must be copied to call functions and compute operations, using R6
classes we can minimize that problem, improving performace for large
datasets.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Allison Mason, Gregory Johnson, Patrick Schloss.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
